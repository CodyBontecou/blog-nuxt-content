<!DOCTYPE html><html  data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.14 | MIT License | https://tailwindcss.com*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}:root{--background:rgba(121,248,252,.15);--foreground:222.2 84% 4.9%;--muted:210 40% 96.1%;--muted-foreground:215.4 16.3% 46.9%;--popover:0 0% 100%;--popover-foreground:222.2 84% 4.9%;--card:0 0% 100%;--card-foreground:222.2 84% 4.9%;--border:214.3 31.8% 91.4%;--input:214.3 31.8% 91.4%;--primary:222.2 47.4% 11.2%;--primary-foreground:210 40% 98%;--secondary:210 40% 96.1%;--secondary-foreground:222.2 47.4% 11.2%;--accent:210 40% 96.1%;--accent-foreground:222.2 47.4% 11.2%;--destructive:0 84.2% 60.2%;--destructive-foreground:210 40% 98%;--ring:222.2 84% 4.9%;--radius:0.5rem}.dark{--background:rgba(121,248,252,.15);--foreground:210 40% 98%;--muted:217.2 32.6% 17.5%;--muted-foreground:215 20.2% 65.1%;--popover:222.2 84% 4.9%;--popover-foreground:210 40% 98%;--card:222.2 84% 4.9%;--card-foreground:210 40% 98%;--border:217.2 32.6% 17.5%;--input:217.2 32.6% 17.5%;--primary:210 40% 98%;--primary-foreground:222.2 47.4% 11.2%;--secondary:217.2 32.6% 17.5%;--secondary-foreground:210 40% 98%;--accent:217.2 32.6% 17.5%;--accent-foreground:210 40% 98%;--destructive:0 62.8% 30.6%;--destructive-foreground:210 40% 98%;--ring:212.7 26.8% 83.9%}*{border-color:hsl(var(--border))}body{color:hsl(var(--foreground))}.container{margin-left:auto;margin-right:auto;padding-left:2rem;padding-right:2rem;width:100%}@media (min-width:1400px){.container{max-width:1400px}}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.-bottom-1{bottom:-.25rem}.-top-1{top:-.25rem}.left-0{left:0}.left-1\/2{left:50%}.right-0{right:0}.right-4{right:1rem}.top-1\/2{top:50%}.top-4{top:1rem}.isolate{isolation:isolate}.z-10{z-index:10}.mx-auto{margin-left:auto;margin-right:auto}.my-20{margin-bottom:5rem;margin-top:5rem}.-mb-14{margin-bottom:-3.5rem}.mb-1{margin-bottom:.25rem}.mb-10{margin-bottom:2.5rem}.mb-12{margin-bottom:3rem}.mb-16{margin-bottom:4rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.ml-3{margin-left:.75rem}.mr-2{margin-right:.5rem}.mt-10{margin-top:2.5rem}.mt-16{margin-top:4rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\[1px\]{height:1px}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-\[80vh\]{max-height:80vh}.w-1\/2{width:50%}.w-1\/4{width:25%}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-3\/4{width:75%}.w-44{width:11rem}.w-5{width:1.25rem}.w-5\/6{width:83.333333%}.w-9{width:2.25rem}.w-\[1px\]{width:1px}.w-full{width:100%}.w-px{width:1px}.w-screen{width:100vw}.max-w-2xl{max-width:42rem}.max-w-3xl{max-width:48rem}.max-w-4xl{max-width:56rem}.max-w-7xl{max-width:80rem}.max-w-lg{max-width:32rem}.max-w-md{max-width:28rem}.max-w-min{max-width:-moz-min-content;max-width:min-content}.flex-none{flex:none}.flex-shrink-0{flex-shrink:0}.shrink{flex-shrink:1}.shrink-0{flex-shrink:0}.grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%}.-translate-x-1\/2,.-translate-x-\[90\%\]{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-\[90\%\]{--tw-translate-x:-90%}.-translate-y-1\/2{--tw-translate-y:-50%}.-translate-y-1\/2,.translate-x-0{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-0{--tw-translate-x:0px}.translate-x-5{--tw-translate-x:1.25rem}.translate-x-5,.translate-y-0{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-0{--tw-translate-y:0px}.translate-y-1{--tw-translate-y:0.25rem}.transform,.translate-y-1{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}.cursor-pointer{cursor:pointer}.list-decimal{list-style-type:decimal}.list-disc{list-style-type:disc}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.gap-x-1{-moz-column-gap:.25rem;column-gap:.25rem}.gap-x-2\.5{-moz-column-gap:.625rem;column-gap:.625rem}.gap-x-3{-moz-column-gap:.75rem;column-gap:.75rem}.gap-x-4{-moz-column-gap:1rem;column-gap:1rem}.gap-y-8{row-gap:2rem}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.75rem*var(--tw-space-y-reverse));margin-top:calc(.75rem*(1 - var(--tw-space-y-reverse)))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1rem*var(--tw-space-y-reverse));margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)))}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis}.truncate,.whitespace-nowrap{white-space:nowrap}.rounded{border-radius:.25rem}.rounded-3xl{border-radius:1.5rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-xl{border-radius:calc(var(--radius) + 4px)}.border{border-width:1px}.border-2{border-width:2px}.border-green-500{--tw-border-opacity:1;border-color:rgb(34 197 94/var(--tw-border-opacity))}.border-indigo-500{--tw-border-opacity:1;border-color:rgb(99 102 241/var(--tw-border-opacity))}.border-input{border-color:hsl(var(--input))}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68/var(--tw-border-opacity))}.border-transparent{border-color:transparent}.bg-background{background-color:hsl(var(--background))}.bg-border{background-color:hsl(var(--border))}.bg-destructive{background-color:hsl(var(--destructive))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235/var(--tw-bg-opacity))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128/var(--tw-bg-opacity))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39/var(--tw-bg-opacity))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229/var(--tw-bg-opacity))}.bg-indigo-600\/10{background-color:rgba(79,70,229,.1)}.bg-primary{background-color:hsl(var(--primary))}.bg-secondary{background-color:hsl(var(--secondary))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gradient-to-b{background-image:linear-gradient(to bottom,var(--tw-gradient-stops))}.bg-gradient-to-t{background-image:linear-gradient(to top,var(--tw-gradient-stops))}.from-\[\#FBFCFF\]{--tw-gradient-from:#fbfcff var(--tw-gradient-from-position);--tw-gradient-to:rgba(251,252,255,0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to)}.to-transparent{--tw-gradient-to:transparent var(--tw-gradient-to-position)}.p-2{padding:.5rem}.p-4{padding:1rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-2\.5{padding-left:.625rem;padding-right:.625rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-10{padding-bottom:2.5rem;padding-top:2.5rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-8{padding-bottom:2rem;padding-top:2rem}.pr-6{padding-right:1.5rem}.pt-16{padding-top:4rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-light{font-weight:300}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-5{line-height:1.25rem}.leading-6{line-height:1.5rem}.leading-7{line-height:1.75rem}.leading-8{line-height:2rem}.leading-tight{line-height:1.25}.tracking-tight{letter-spacing:-.025em}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.text-destructive-foreground{color:hsl(var(--destructive-foreground))}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219/var(--tw-text-opacity))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229/var(--tw-text-opacity))}.text-muted-foreground{color:hsl(var(--muted-foreground))}.text-primary{color:hsl(var(--primary))}.text-primary-foreground{color:hsl(var(--primary-foreground))}.text-secondary-foreground{color:hsl(var(--secondary-foreground))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.underline{text-decoration-line:underline}.underline-offset-4{text-underline-offset:4px}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-90{opacity:.9}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.ring-0{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(var(--tw-ring-offset-width)) var(--tw-ring-color)}.ring-0,.ring-1{box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color)}.ring-inset{--tw-ring-inset:inset}.ring-gray-200{--tw-ring-opacity:1;--tw-ring-color:rgb(229 231 235/var(--tw-ring-opacity))}.ring-gray-900\/5{--tw-ring-color:rgba(17,24,39,.05)}.ring-indigo-200{--tw-ring-opacity:1;--tw-ring-color:rgb(199 210 254/var(--tw-ring-opacity))}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-150,.transition-colors{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-in{transition-timing-function:cubic-bezier(.4,0,1,1)}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}@keyframes enter{0%{opacity:var(--tw-enter-opacity,1);transform:translate3d(var(--tw-enter-translate-x,0),var(--tw-enter-translate-y,0),0) scale3d(var(--tw-enter-scale,1),var(--tw-enter-scale,1),var(--tw-enter-scale,1)) rotate(var(--tw-enter-rotate,0))}}@keyframes exit{to{opacity:var(--tw-exit-opacity,1);transform:translate3d(var(--tw-exit-translate-x,0),var(--tw-exit-translate-y,0),0) scale3d(var(--tw-exit-scale,1),var(--tw-exit-scale,1),var(--tw-exit-scale,1)) rotate(var(--tw-exit-rotate,0))}}.duration-150{animation-duration:.15s}.duration-200{animation-duration:.2s}.duration-300{animation-duration:.3s}.ease-in{animation-timing-function:cubic-bezier(.4,0,1,1)}.ease-in-out{animation-timing-function:cubic-bezier(.4,0,.2,1)}.ease-out{animation-timing-function:cubic-bezier(0,0,.2,1)}.running{animation-play-state:running}.hover\:bg-accent:hover{background-color:hsl(var(--accent))}.hover\:bg-destructive\/90:hover{background-color:hsl(var(--destructive)/.9)}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81/var(--tw-bg-opacity))}.hover\:bg-indigo-500:hover{--tw-bg-opacity:1;background-color:rgb(99 102 241/var(--tw-bg-opacity))}.hover\:bg-primary\/90:hover{background-color:hsl(var(--primary)/.9)}.hover\:bg-secondary\/80:hover{background-color:hsl(var(--secondary)/.8)}.hover\:text-accent-foreground:hover{color:hsl(var(--accent-foreground))}.hover\:text-indigo-600:hover{--tw-text-opacity:1;color:rgb(79 70 229/var(--tw-text-opacity))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-50:hover{opacity:.5}.hover\:opacity-75:hover{opacity:.75}.hover\:ring-indigo-300:hover{--tw-ring-opacity:1;--tw-ring-color:rgb(165 180 252/var(--tw-ring-opacity))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.focus\:ring-gray-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(107 114 128/var(--tw-ring-opacity))}.focus\:ring-indigo-600:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(79 70 229/var(--tw-ring-opacity))}.focus\:ring-offset-2:focus{--tw-ring-offset-width:2px}.focus-visible\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\:outline:focus-visible{outline-style:solid}.focus-visible\:outline-2:focus-visible{outline-width:2px}.focus-visible\:outline-offset-2:focus-visible{outline-offset:2px}.focus-visible\:outline-indigo-600:focus-visible{outline-color:#4f46e5}.focus-visible\:ring-1:focus-visible{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.focus-visible\:ring-ring:focus-visible{--tw-ring-color:hsl(var(--ring))}.disabled\:pointer-events-none:disabled{pointer-events:none}.disabled\:opacity-50:disabled{opacity:.5}@media (min-width:640px){.sm\:mt-20{margin-top:5rem}.sm\:flex-row{flex-direction:row}.sm\:px-6{padding-left:1.5rem;padding-right:1.5rem}.sm\:text-5xl{font-size:3rem;line-height:1}.sm\:text-6xl{font-size:3.75rem;line-height:1}}@media (min-width:768px){.md\:w-full{width:100%}}@media (min-width:1024px){.lg\:z-10{z-index:10}.lg\:mx-0{margin-left:0;margin-right:0}.lg\:mb-0{margin-bottom:0}.lg\:mt-0{margin-top:0}.lg\:mt-8{margin-top:2rem}.lg\:grid{display:grid}.lg\:max-w-none{max-width:none}.lg\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:gap-x-12{-moz-column-gap:3rem;column-gap:3rem}.lg\:rounded-b-none{border-bottom-left-radius:0;border-bottom-right-radius:0}.lg\:rounded-l-none{border-bottom-left-radius:0;border-top-left-radius:0}.lg\:rounded-r-none{border-bottom-right-radius:0;border-top-right-radius:0}.lg\:px-8{padding-left:2rem;padding-right:2rem}.lg\:pt-0{padding-top:0}}@media (min-width:1280px){.xl\:p-10{padding:2.5rem}}.\[\&_svg\]\:pointer-events-none svg{pointer-events:none}.\[\&_svg\]\:size-4 svg{height:1rem;width:1rem}.\[\&_svg\]\:shrink-0 svg{flex-shrink:0}</style>
<style>pre code .line{display:block;min-height:1rem}</style>
<link rel="stylesheet" href="/_nuxt/ProsePre.B_fgAJq0.css">
<link rel="preload" as="fetch" crossorigin="anonymous" href="/stripe-integration-in-nuxt-3/_payload.json?bee36402-9458-4c0a-a7be-77597351ee38">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BFvqfGYD.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BpLavul2.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/-YWcvqmf.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/PN-oVKHf.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DtoeRFHR.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CoQtG8VD.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C-v3KzvZ.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Dnd51l0P.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bnf1E_mG.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B9TIH4Oe.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/2UJmm52Z.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BgtIJdO_.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BvFbqV5C.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BtWVIeAq.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CWkeh5PA.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/q9E_M9gH.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/D_vjqkwn.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B3TPs37F.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CAQTpt-J.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/gwdQrYYA.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B7n1w72m.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DwPbW9Oa.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/DlR-6Ssu.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BtOjpmIj.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/BvWc-USP.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/Brgkr1N1.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C2En2EYK.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/CEpSqTjF.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/C-kmJf1c.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/bTx0GDRv.js">
<link rel="modulepreload" as="script" crossorigin href="/_nuxt/B8Ro41gd.js">
<link rel="prefetch" as="style" crossorigin href="/_nuxt/useStudio.Tc7-ghOt.css">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/CpwjumpD.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/DvN6btgG.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/CNx-zLr5.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/tVllzOK6.js">
<link rel="prefetch" as="script" crossorigin href="/_nuxt/CO8Qr04C.js">
<script type="module" src="/_nuxt/BFvqfGYD.js" crossorigin></script></head><body><div id="__nuxt"><div><div class="max-w-3xl mx-auto py-8 px-4"><header class="flex justify-between items-center mb-16"><h1 class=""><a href="/" class="hover:opacity-75"> Cody Bontecou </a></h1><nav class="flex gap-6 text-gray-600"><a href="/" class=""> Articles </a><a href="/" class=""> Learn more </a></nav></header><main><article class=""><h1 class="text-4xl font-normal mb-4">Stripe Integration in Nuxt 3</h1><div class="text-gray-600 text-lg mb-10">August 21, 2024 Â·  minute read</div><div><h1 id><!--[--><!--]--></h1><h2 id="_01-introduction"><a href="#_01-introduction"><!--[-->01 - Introduction<!--]--></a></h2><p><!--[-->Welcome to my Nuxt + Stripe tutorial.
This course covers Authentication with @sidebase/nuxt-auth and Github, Stripe Checkout, Stripe Billing Portal, Stripe Webhooks, Stripe Subscriptions, and more.<!--]--></p><p><!--[-->Each branch of this repo represents a different section of the course. For example, branch 01-installation should be 1:1 with the first video of the course.<!--]--></p><p><!--[-->At the end of this course, you will have a page similar to this setup and deployed online, accepting payments with Stripe.<!--]--></p><p><!--[-->All of the code is hosted on my Github in my <a href="https://github.com/codybontecou/nuxt-stripe" rel="nofollow"><!--[-->nuxt-stripe<!--]--></a> repo. Each branch represents the specific section of the course.<!--]--></p><p><!--[--><img src="https://cln.sh/dKfgxlB3+" alt="landing page|500"><!--]--></p><h2 id="_02-installation"><a href="#_02-installation"><!--[-->02 - Installation<!--]--></a></h2><p><!--[-->Let&#39;s get your project installed and running. This lesson is all about front-loading our dependencies so we don&#39;t have to worry about them in later lessons.<!--]--></p><p><!--[-->Start by creating a Nuxt application if you do not already have one set up. Run the following command to do this:<!--]--></p><p><!--[--><code class=""><!--[-->npx nuxi init nuxt-stripe<!--]--></code><!--]--></p><h3 id="auth-dependencies"><a href="#auth-dependencies"><!--[-->Auth Dependencies<!--]--></a></h3><p><!--[-->We&#39;ll be relying on <a href="https://auth.sidebase.io" rel="nofollow"><!--[-->Nuxt Auth<!--]--></a> for our authentication needs. This is a wrapper around Next Auth that makes it easy to use with Nuxt. There is an issue that makes Nuxt Auth reliant on next-auth version 4.21.1, so we&#39;ll install that version specifically.<!--]--></p><p><!--[--><code class=""><!--[-->npm install @auth/core @sidebase/nuxt-auth@^0.9.0 next-auth@4.21.1<!--]--></code><!--]--></p><h3 id="db-dependencies"><a href="#db-dependencies"><!--[-->DB Dependencies<!--]--></a></h3><p><!--[--><a href="https://www.prisma.io" rel="nofollow"><!--[-->Prisma<!--]--></a> is my go-to ORM for Node.js projects. It&#39;s easy to use and has a great query builder. We&#39;ll be using it to interact with our database.<!--]--></p><p><!--[-->If you prefer a different solution, use it. There&#39;s nothing specific that Prisma solves that other ORM&#39;s and database drivers don&#39;t. It&#39;s just my preference and what I will be showing in the code snippets.<!--]--></p><p><!--[--><code class=""><!--[-->npm install prisma @prisma/client @next-auth/prisma-adapter<!--]--></code><!--]--></p><h3 id="ui-dependencies"><a href="#ui-dependencies"><!--[-->UI Dependencies<!--]--></a></h3><p><!--[-->The UI for this project will be built with <a href="https://tailwindcss.com" rel="nofollow"><!--[-->Tailwind CSS<!--]--></a> and <a href="https://headlessui.com" rel="nofollow"><!--[-->Headless UI<!--]--></a>. Headless UI is a collection of unstyled, fully accessible UI components, designed to integrate beautifully with Tailwind CSS.<!--]--></p><p><!--[-->I&#39;m using components directly from <a href="http://tailwindui.com" rel="nofollow"><!--[-->TailwindUI<!--]--></a>. Because this is a course on Nuxt and Stripe, I won&#39;t be explaining much about the UI. I&#39;m just bringing these dependencies in for presentation reasons.<!--]--></p><p><!--[--><code class=""><!--[-->npx nuxi@latest module add @nuxtjs/tailwindcss<!--]--></code><!--]--></p><p><!--[--><code class=""><!--[-->npm install @headlessui/vue @heroicons/vue<!--]--></code><!--]--></p><h3 id="stripe-dependencies"><a href="#stripe-dependencies"><!--[-->Stripe Dependencies<!--]--></a></h3><p><!--[-->Stripe is easy. We&#39;ll only need one dependency: the Stripe Node.js library.<!--]--></p><p><!--[--><code class=""><!--[-->npm install stripe<!--]--></code><!--]--></p><h3 id="tldr"><a href="#tldr"><!--[-->TLDR:<!--]--></a></h3><p><!--[-->You can expedite this running these commands:<!--]--></p><p><!--[--><code class=""><!--[-->npx nuxi init nuxt-stripe<!--]--></code><!--]--></p><p><!--[--><code class=""><!--[-->npm install @auth/core @sidebase/nuxt-auth next-auth@4.21.1 prisma @prisma/client @next-auth/prisma-adapter @headlessui/vue @heroicons/vue stripe<!--]--></code><!--]--></p><p><!--[--><code class=""><!--[-->npx nuxi@latest module add @nuxtjs/tailwindcss<!--]--></code><!--]--></p><h2 id="_03-auth"><a href="#_03-auth"><!--[-->03 - Auth<!--]--></a></h2><blockquote><!--[--><p><!--[-->Now we can begin!<!--]--></p><!--]--></blockquote><p><!--[-->Authentication requires setting up a few things:<!--]--></p><ol><!--[--><li><!--[-->The <code class=""><!--[-->auth<!--]--></code> and <code class=""><!--[-->runtimeConfig<!--]--></code> sections of the <code class=""><!--[-->nuxt.config.ts<!--]--></code> file.<!--]--></li><li><!--[--><code class=""><!--[-->.env<!--]--></code> file to manage environment variables.<!--]--></li><li><!--[-->The <code class=""><!--[-->[...].ts<!--]--></code> file located at <code class=""><!--[-->server/api/auth/[...].ts<!--]--></code>.<!--]--></li><li><!--[-->Prisma and our database schema<!--]--></li><li><!--[-->Clientside code to sign in and sign out<!--]--></li><!--]--></ol><h3 id="nuxtconfigts"><a href="#nuxtconfigts"><!--[--><code class=""><!--[-->nuxt.config.ts<!--]--></code><!--]--></a></h3><h3 id="_1-nuxt-auth-module"><a href="#_1-nuxt-auth-module"><!--[-->1. nuxt-auth module<!--]--></a></h3><p><!--[-->We need to add our newly installed <code class=""><!--[-->@sidebase/nuxt-auth<!--]--></code> package to our Nuxt config&#39;s <code class=""><!--[-->module<!--]--></code> array.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// nuxt.config.ts
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> defineNuxtConfig</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  modules: [</span><span style="--shiki-default:#032F62">&#39;@nuxtjs/tailwindcss&#39;</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#032F62">&#39;@sidebase/nuxt-auth&#39;</span><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><h4 id="runtime-config"><a href="#runtime-config"><!--[-->Runtime Config<!--]--></a></h4><p><!--[-->The recommended way of exposing our environment variables is to use Nuxt&#39;s <a href="https://nuxt.com/docs/guide/going-further/runtime-config" rel="nofollow"><!--[-->Runtime Config<!--]--></a>. This enables us to utilize the <code class=""><!--[-->useRuntimeConfig<!--]--></code> composable on both client and server which gives us access to environment variables.<!--]--></p><p><!--[-->Let&#39;s add the environment variables we need to roll out authentication.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// nuxt.config.ts
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> defineNuxtConfig</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  modules: [</span><span style="--shiki-default:#032F62">&#39;@nuxtjs/tailwindcss&#39;</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#032F62">&#39;@sidebase/nuxt-auth&#39;</span><span style="--shiki-default:#24292E">],
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">  runtimeConfig: {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    AUTH_SECRET: process.env.</span><span style="--shiki-default:#005CC5">AUTH_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_ID: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_ID</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_SECRET: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->I&#39;ll explain where <code class=""><!--[-->AUTH_SECRET<!--]--></code>, <code class=""><!--[-->GITHUB_CLIENT_ID<!--]--></code> and <code class=""><!--[-->GITHUB_CLIENT_SECRET<!--]--></code> come from later in this article.<!--]--></p><h4 id="auth-config"><a href="#auth-config"><!--[-->auth config<!--]--></a></h4><p><!--[-->Now, we need to add the <code class=""><!--[-->auth<!--]--></code> config. The configuration options be explored further in <a href="https://auth.sidebase.io/guide/application-side/configuration" rel="nofollow"><!--[-->Sidebase&#39;s docs<!--]--></a>.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// nuxt.config.ts
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> defineNuxtConfig</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  modules: [</span><span style="--shiki-default:#032F62">&#39;@nuxtjs/tailwindcss&#39;</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#032F62">&#39;@sidebase/nuxt-auth&#39;</span><span style="--shiki-default:#24292E">],
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">  runtimeConfig: {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    AUTH_SECRET: process.env.</span><span style="--shiki-default:#005CC5">AUTH_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_ID: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_ID</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_SECRET: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  auth: {
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    originEnvKey: </span><span style="--shiki-default:#032F62">&#39;AUTH_ORIGIN&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">    baseURL: </span><span style="--shiki-default:#032F62">&#39;http://localhost:3000/api/auth&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">    provider: {
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;authjs&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      defaultProvider: </span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">      addDefaultCallbackUrl: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">    sessionRefresh: {
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      enablePeriodically: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">      enableOnWindowFocus: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[--><strong><!--[-->Note:<!--]--></strong> I am not doing any custom <code class=""><!--[-->auth<!--]--></code> configuration and am simply providing the default configuration that their <a href="https://auth.sidebase.io/guide/application-side/configuration" rel="nofollow"><!--[-->documentation<!--]--></a> suggests.<!--]--></p><h3 id="_2-env-file"><a href="#_2-env-file"><!--[-->2. .env file<!--]--></a></h3><p><!--[-->The <code class=""><!--[-->.env<!--]--></code> file is where we manage environment variables, specifically, secret keys that we do not want to to end up in source control. Create the file if you do not already have one, and place it in your project&#39;s root directory. This file will grow with time, but initially, we just need three keys:<!--]--></p><!--[--><pre class="language-toml shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span>// .env
</span></span><span class="line" line="2"><span>GITHUB_CLIENT_ID=
</span></span><span class="line" line="3"><span>GITHUB_CLIENT_SECRET=
</span></span><span class="line" line="4"><span>AUTH_SECRET=
</span></span></code><!--]--></pre><!--]--><p><!--[-->To get the values, you&#39;ll need to fill out this <a href="https://github.com/settings/applications/new" rel="nofollow"><!--[-->Github application<!--]--></a>.  Here&#39;s what my form looks like:<!--]--></p><p><!--[--><img src="https://cln.sh/kJjW3vSQ+" alt="image|500"><!--]--></p><ul><!--[--><li><!--[--><strong><!--[-->Application Name<!--]--></strong>: Name this whatever you like<!--]--></li><li><!--[--><strong><!--[-->Homepage URL:<!--]--></strong> This should be set to the port you are developing your application on. Nuxt&#39;s default is on port 3000 so that is what I set it to. Configure this as needed.<!--]--></li><li><!--[--><strong><!--[-->Authorization callback URL:<!--]--></strong> Same as the Homepage URL, I am using the default port 3000. What is <strong><!--[-->important<!--]--></strong> here is the <code class=""><!--[-->/api/auth/callback/github<!--]--></code>. This is the default endpoint Nuxt Auth provides and is important for our authentication flow.<!--]--></li><!--]--></ul><p><!--[-->You should now see the Client ID and the ability to generate a Client Secret:<!--]--></p><p><!--[--><img src="https://share.cleanshot.com/XM6tYFt8+" alt="github oauth panel|500"><!--]--></p><p><!--[-->Place <strong><!--[-->your<!--]--></strong> Client ID and Client Secret values into your .env file.<!--]--></p><!--[--><pre class="language-toml shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span>// .env
</span></span><span class="line" line="2"><span>GITHUB_CLIENT_ID=Ov23liXNQBrzCfy450re
</span></span><span class="line" line="3"><span>GITHUB_CLIENT_SECRET=ab00828302cd662072eaffe70c41f048d3879536
</span></span><span class="line" line="4"><span>AUTH_SECRET=
</span></span></code><!--]--></pre><!--]--><blockquote><!--[--><p><!--[-->The values I am showing have already been deleted and will not work. You must generate your own.<!--]--></p><!--]--></blockquote><p><!--[--><code class=""><!--[-->AUTH_SECRET<!--]--></code> is a secret key that we must generate ourselves. The secret is a random string used to hash tokens, sign and encrypt cookie and generate cryptographic keys. This isn&#39;t necessary for development, but is <strong><!--[-->required<!--]--></strong> once the application is deployed.<!--]--></p><p><!--[-->Run <code class=""><!--[-->openssl rand -base64 32<!--]--></code> in your terminal to generate this value. Copy and paste the output into your <code class=""><!--[-->.env<!--]--></code> file and store it within <code class=""><!--[-->AUTH_SECRET<!--]--></code>.<!--]--></p><p><!--[-->You can read more about in the <a href="https://auth.sidebase.io/guide/authjs/nuxt-auth-handler#secret" rel="nofollow"><!--[-->NuxtAuth docs<!--]--></a>.<!--]--></p><h3 id="_3-serverapiauthts"><a href="#_3-serverapiauthts"><!--[-->3. <code class=""><!--[-->server/api/auth/[...].ts<!--]--></code><!--]--></a></h3><p><!--[-->Next up is our <code class=""><!--[-->[...].ts<!--]--></code> file. This will be where the majority of the code that configures our authentication logic is held.<!--]--></p><p><!--[-->If you&#39;re not familiar, <span>...</span> is the Nuxt syntax for a <a href="https://nuxt.com/docs/guide/directory-structure/server#catch-all-route" rel="nofollow"><!--[-->catch-all route<!--]--></a>.<!--]--></p><p><!--[-->By placing it at the endpoint <code class=""><!--[-->api/auth/[...].ts<!--]--></code>, it allows there to be many valid values after <code class=""><!--[-->api/auth/<!--]--></code>. Some of the defaults that are included with @sidebase/nuxt-auth include <code class=""><!--[-->api/auth/signin<!--]--></code> and <code class=""><!--[-->api/auth/signout<!--]--></code>.<!--]--></p><p><!--[-->Let&#39;s start with this code snippet:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/auth/[...].ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> GithubProvider </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;next-auth/providers/github&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { NuxtAuthHandler } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;#auth&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaAdapter } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@next-auth/prisma-adapter&#39;
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> runtimeConfig</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> useRuntimeConfig</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> NuxtAuthHandler</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  secret: runtimeConfig.</span><span style="--shiki-default:#005CC5">AUTH_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  adapter: </span><span style="--shiki-default:#6F42C1">PrismaAdapter</span><span style="--shiki-default:#24292E">(prisma),
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  providers: [
</span></span><span class="line" line="14"><span style="--shiki-default:#6A737D">    // @ts-expect-error
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">    GithubProvider.</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      clientId: runtimeConfig.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_ID</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">      clientSecret: runtimeConfig.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">    }),
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  ],
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><ol><!--[--><li><!--[--><strong><!--[-->Secret:<!--]--></strong> We use our <code class=""><!--[-->runtimeConfig<!--]--></code> to access our <code class=""><!--[-->AUTH_SECRET<!--]--></code> and <code class=""><!--[-->GITHUB_*<!--]--></code> environment variables.<!--]--></li><li><!--[--><strong><!--[-->Adapter:<!--]--></strong> We create a new <code class=""><!--[-->PrismaClient<!--]--></code> that is passed to the NuxtAuthHandler&#39;s <code class=""><!--[-->adapter<!--]--></code>.
<ul><!--[--><li><!--[-->&quot;Adapters are the bridge we use to connect NuxtAuth to your database.&quot; (<a href="https://authjs.dev/getting-started/database?_gl=1*1ry7ee*_gcl_au*NDc1MTI5NzEzLjE3MjM3Njg4Njk." rel="nofollow"><!--[-->docs<!--]--></a>) Adapter&#39;s provide the functions that NuxtAuth call when authentication occurs. For example, when a user is created, NuxtAuth will call the PrismaAdapter&#39;s <code class=""><!--[-->createUser<!--]--></code> function.<!--]--></li><li><!--[--><a href="https://github.com/nextauthjs/next-auth/blob/main/packages/adapter-prisma/src/index.ts" rel="nofollow"><!--[-->Here&#39;s a reference to the PrismaAdapter code if you are curious.<!--]--></a><!--]--></li><!--]--></ul><!--]--></li><li><!--[--><strong><!--[-->Providers<!--]--></strong>: This is an array of the authentication providers we enable.
<ul><!--[--><li><!--[-->In this course, we will only use Github. You can see we import the <code class=""><!--[-->GithubProvider<!--]--></code> from <code class=""><!--[-->next-auth/providers/github<!--]--></code>. There are lots of providers you can hook into in a similar way. Check out <a href="https://authjs.dev/getting-started/providers/github" rel="nofollow"><!--[-->Auth.js&#39; docs<!--]--></a> for a larger list of built-in provider options.<!--]--></li><!--]--></ul><!--]--></li><!--]--></ol><h3 id="_4-prisma-orm-database-schema"><a href="#_4-prisma-orm-database-schema"><!--[-->4. Prisma ORM + Database Schema<!--]--></a></h3><p><!--[--><a href="https://www.prisma.io/orm" rel="nofollow"><!--[-->Prisma ORM<!--]--></a> is the database management tool I chose to use for this tutorial. It helps manage the database schema, database migrations, and database queries using Typescript.<!--]--></p><p><!--[-->When a user logs in, we use the <code class=""><!--[-->PrismaAdapter<!--]--></code> to save the logged in user into our database. This is essential if we are to collect payments from them and persist their subscription status.<!--]--></p><p><!--[-->You should already have Prisma installed. But there is an additional command we have to run:<!--]--></p><p><!--[--><code class=""><!--[-->npx prisma init --datasource-provider sqlite<!--]--></code><!--]--></p><p><!--[-->This will:<!--]--></p><ul><!--[--><li><!--[-->Create a prisma directory in your application.<!--]--></li><li><!--[-->Set the <code class=""><!--[-->DATABASE_URL<!--]--></code> environment variable in your <code class=""><!--[-->.env<!--]--></code> file to a local sqlite database<!--]--></li><li><!--[-->Create a base <code class=""><!--[-->schema.prisma<!--]--></code> file within the prisma directory pointing to your <code class=""><!--[-->DATABASE_URL<!--]--></code><!--]--></li><!--]--></ul><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// schema.prisma
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">generator client {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  provider </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62"> &quot;prisma-client-js&quot;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">datasource db {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  provider </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62"> &quot;sqlite&quot;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  url      </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> env</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&quot;DATABASE_URL&quot;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->Following Auth.js <a href="https://authjs.dev/getting-started/adapters/prisma" rel="nofollow"><!--[-->Prisma Adapter docs<!--]--></a>, we need to update the schema to:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// schema.prisma
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">datasource db {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  provider </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62"> &quot;sqlite&quot;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  url      </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> env</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&quot;DATABASE_URL&quot;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">generator client {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  provider </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62"> &quot;prisma-client-js&quot;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">model User {
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  id            String          @id @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#6F42C1">cuid</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  name          String</span><span style="--shiki-default:#D73A49">?
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  email         String</span><span style="--shiki-default:#D73A49">?</span><span style="--shiki-default:#24292E">         @unique
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">  emailVerified DateTime</span><span style="--shiki-default:#D73A49">?
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  image         String</span><span style="--shiki-default:#D73A49">?
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">  accounts      Account[]
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">  sessions      Session[]
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">  createdAt DateTime @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#6F42C1">now</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">  updatedAt DateTime @updatedAt
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">model Account {
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">  id                String  @id @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">cuid</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">  userId            String
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">  type              String
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">  provider          String
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">  providerAccountId String
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">  refresh_token     String?
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">  access_token      String?
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">  expires_at        Int?
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">  token_type        String?
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">  scope             String?
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">  id_token          String?
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">  session_state     String?
</span></span><span class="line" line="37"><span emptylineplaceholder="true">
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">  createdAt DateTime @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">now</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">  updatedAt DateTime @updatedAt
</span></span><span class="line" line="40"><span emptylineplaceholder="true">
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">  user User @</span><span style="--shiki-default:#6F42C1">relation</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">fields</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> [</span><span style="--shiki-default:#6F42C1">userId</span><span style="--shiki-default:#24292E">], </span><span style="--shiki-default:#E36209">references</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> [</span><span style="--shiki-default:#6F42C1">id</span><span style="--shiki-default:#24292E">], </span><span style="--shiki-default:#E36209">onDelete</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#6F42C1"> Cascade</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="42"><span emptylineplaceholder="true">
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">  @@</span><span style="--shiki-default:#6F42C1">unique</span><span style="--shiki-default:#24292E">([</span><span style="--shiki-default:#E36209">provider</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#E36209">providerAccountId</span><span style="--shiki-default:#24292E">])
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="45"><span emptylineplaceholder="true">
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E">model Session {
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">  id           String   @id @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">cuid</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">  sessionToken String   @unique
</span></span><span class="line" line="49"><span style="--shiki-default:#24292E">  userId       String
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">  expires      DateTime
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">  user         User     @</span><span style="--shiki-default:#6F42C1">relation</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">fields</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> [</span><span style="--shiki-default:#6F42C1">userId</span><span style="--shiki-default:#24292E">], </span><span style="--shiki-default:#E36209">references</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> [</span><span style="--shiki-default:#6F42C1">id</span><span style="--shiki-default:#24292E">], </span><span style="--shiki-default:#E36209">onDelete</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#6F42C1"> Cascade</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="52"><span emptylineplaceholder="true">
</span></span><span class="line" line="53"><span style="--shiki-default:#24292E">  createdAt DateTime @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">now</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E">  updatedAt DateTime @updatedAt
</span></span><span class="line" line="55"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="56"><span emptylineplaceholder="true">
</span></span><span class="line" line="57"><span style="--shiki-default:#24292E">model VerificationToken {
</span></span><span class="line" line="58"><span style="--shiki-default:#24292E">  identifier String
</span></span><span class="line" line="59"><span style="--shiki-default:#24292E">  token      String
</span></span><span class="line" line="60"><span style="--shiki-default:#24292E">  expires    DateTime
</span></span><span class="line" line="61"><span emptylineplaceholder="true">
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">  @@</span><span style="--shiki-default:#6F42C1">unique</span><span style="--shiki-default:#24292E">([</span><span style="--shiki-default:#E36209">identifier</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#E36209">token</span><span style="--shiki-default:#24292E">])
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[--><strong><!--[-->Note:<!--]--></strong> I deleted the optional <code class=""><!--[-->Authenticator<!--]--></code> table from the documentation. We will not be implementing WebAuthn support.<!--]--></p><p><!--[-->This schema creates the tables used for the authentication flow. But, we need to run two additional commands:<!--]--></p><p><!--[--><code class=""><!--[-->npx prisma generate<!--]--></code> - This generates Typescript types that mirror your database schema, giving us excellent auto-complete and type-errors.<!--]--></p><p><!--[--><code class=""><!--[-->npx prisma migrate dev<!--]--></code> - This creates the migration file that contains the SQL that is then applied to your database. This command will prompt you to enter a name for the migration. This can be anything and should be used to describe the changes made to your database.<!--]--></p><p><!--[-->Your prisma directory should now look like:<!--]--></p><!--[--><pre class="language-bash shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1">prisma
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1">-</span><span style="--shiki-default:#032F62"> migrations
</span></span><span class="line" line="3"><span style="--shiki-default:#6F42C1">--</span><span style="--shiki-default:#032F62"> migrationName</span><span style="--shiki-default:#032F62"> directory
</span></span><span class="line" line="4"><span style="--shiki-default:#6F42C1">---</span><span style="--shiki-default:#032F62"> migration.sql
</span></span><span class="line" line="5"><span style="--shiki-default:#6F42C1">--</span><span style="--shiki-default:#032F62"> migration_lock.toml
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">-</span><span style="--shiki-default:#032F62"> dev.db
</span></span><span class="line" line="7"><span style="--shiki-default:#6F42C1">-</span><span style="--shiki-default:#032F62"> dev.db-journal
</span></span><span class="line" line="8"><span style="--shiki-default:#6F42C1">-</span><span style="--shiki-default:#032F62"> schema.prisma
</span></span></code><!--]--></pre><!--]--><p><!--[-->We should now be hooked up and ready to authenticate on the client.<!--]--></p><h3 id="_5-client-side-authentication"><a href="#_5-client-side-authentication"><!--[-->5. Client-side Authentication<!--]--></a></h3><blockquote><!--[--><p><!--[-->Let&#39;s now interact with the server-side code on the client.<!--]--></p><!--]--></blockquote><p><!--[-->First, convert your <code class=""><!--[-->app.vue<!--]--></code> file to navigate users to <code class=""><!--[-->NuxtPage<!--]--></code>:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// app.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">NuxtPage</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->And create a <code class=""><!--[-->pages<!--]--></code> directory with the file <code class=""><!--[-->index.vue<!--]--></code>:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// pages/index.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#24292E">&gt;&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;Hello World&lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->We can now hook into the <a href="https://auth.sidebase.io/guide/application-side/session-access#useauth-composable" rel="nofollow"><!--[-->useAuth<!--]--></a> composable exposed by @sidebase/nuxt-auth and create signin and signout buttons as well as dynamically rendering the user&#39;s authentication status.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// pages/index.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signOut</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;You are currently {{ status }}.&lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;status === &#39;authenticated&#39;&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#6F42C1"> @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;signOut()&quot;</span><span style="--shiki-default:#24292E">&gt;Sign out&lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> v-else</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#6F42C1"> @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;signIn(&#39;github&#39;)&quot;</span><span style="--shiki-default:#24292E">&gt;Sign in with GitHub&lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[--><strong><!--[-->Optional:<!--]--></strong> Here&#39;s a code snippet with a bit of styling:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// pages/index.vue
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signOut</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;h-screen w-screen flex items-center justify-center&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex flex-col gap-4&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;You are currently {{ status }}.&lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;status === &#39;authenticated&#39;&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="14"><span style="--shiki-default:#6F42C1">            class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center justify-center px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500&quot;
</span></span><span class="line" line="15"><span style="--shiki-default:#6F42C1">            @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;signOut()&quot;
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">          &gt;
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">            Sign out
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> v-else</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="22"><span style="--shiki-default:#6F42C1">            @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;signIn(&#39;github&#39;)&quot;
</span></span><span class="line" line="23"><span style="--shiki-default:#6F42C1">            class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center justify-center px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500&quot;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">          &gt;
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">svg
</span></span><span class="line" line="26"><span style="--shiki-default:#6F42C1">              class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;w-5 h-5 mr-2&quot;
</span></span><span class="line" line="27"><span style="--shiki-default:#6F42C1">              fill</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;currentColor&quot;
</span></span><span class="line" line="28"><span style="--shiki-default:#6F42C1">              viewBox</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;0 0 20 20&quot;
</span></span><span class="line" line="29"><span style="--shiki-default:#6F42C1">              xmlns</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;http://www.w3.org/2000/svg&quot;
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">            &gt;
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">path
</span></span><span class="line" line="32"><span style="--shiki-default:#6F42C1">                fill-rule</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;evenodd&quot;
</span></span><span class="line" line="33"><span style="--shiki-default:#6F42C1">                d</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z&quot;
</span></span><span class="line" line="34"><span style="--shiki-default:#6F42C1">                clip-rule</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;evenodd&quot;
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">              /&gt;
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">svg</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">            Sign in with GitHub
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->You should now be able to sign in and out using Github!<!--]--></p><h2 id="_04-pricing-page"><a href="#_04-pricing-page"><!--[-->04 - Pricing Page<!--]--></a></h2><blockquote><!--[--><p><!--[-->This section is optional but I think many people will appreciate it.<!--]--></p><!--]--></blockquote><p><!--[-->We will create the pricing page that people tend to expect when buying an online product:<!--]--></p><p><!--[--><img src="https://cln.sh/dKfgxlB3+" alt="Pricing Page|800"><!--]--></p><h3 id="auth-menu-avatar"><a href="#auth-menu-avatar"><!--[-->Auth Menu / Avatar<!--]--></a></h3><p><!--[-->Let&#39;s start with the avatar in the top right corner.<!--]--></p><p><!--[-->When logged in, this will show the avatar image you are using on Github. When logged out, this will be a simple sign in button. It also has a few dropdown menu options.<!--]--></p><p><!--[--><img src="https://cln.sh/Pq0tptg2+" alt="Auth Menu|300"><!--]--></p><p><!--[-->This component heavily relies on TailwindCSS and <a href="https://headlessui.com/v1/vue" rel="nofollow"><!--[-->HeadlessUI<!--]--></a>.<!--]--></p><p><!--[-->I start with the <code class=""><!--[-->AuthAvatar<!--]--></code>, which is simply the circle with the image in it:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/AuthAvatar.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">interface</span><span style="--shiki-default:#6F42C1"> Props</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#E36209">  src</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> null</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> undefined
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">defineProps</span><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#6F42C1">Props</span><span style="--shiki-default:#24292E">&gt;()
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">img
</span></span><span class="line" line="11"><span style="--shiki-default:#6F42C1">    v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;src&quot;
</span></span><span class="line" line="12"><span style="--shiki-default:#6F42C1">    class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;inline-block h-10 w-10 rounded-full bg-gray-500&quot;
</span></span><span class="line" line="13"><span style="--shiki-default:#6F42C1">    :src</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;src&quot;
</span></span><span class="line" line="14"><span style="--shiki-default:#6F42C1">    alt</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;User avatar&quot;
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">  /&gt;
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">span
</span></span><span class="line" line="17"><span style="--shiki-default:#6F42C1">    v-else
</span></span><span class="line" line="18"><span style="--shiki-default:#6F42C1">    class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;inline-block h-10 w-10 overflow-hidden rounded-full bg-gray-100&quot;
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  &gt;
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">svg
</span></span><span class="line" line="21"><span style="--shiki-default:#6F42C1">      class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;h-full w-full text-gray-300&quot;
</span></span><span class="line" line="22"><span style="--shiki-default:#6F42C1">      fill</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;currentColor&quot;
</span></span><span class="line" line="23"><span style="--shiki-default:#6F42C1">      viewBox</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;0 0 24 24&quot;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">    &gt;
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">path
</span></span><span class="line" line="26"><span style="--shiki-default:#6F42C1">        d</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z&quot;
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">      /&gt;
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">svg</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->And then I use this within the <code class=""><!--[-->AuthMenu<!--]--></code> component. It&#39;s a relatively simple component once HeadlessUI does the heavy lifting:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/AuthMenu.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { Popover, PopoverButton, PopoverPanel } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@headlessui/vue&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signOut</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> solutions</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Manage Billing&#39;</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#6F42C1">fn</span><span style="--shiki-default:#24292E">: () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {} },
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Sign Out&#39;</span><span style="--shiki-default:#24292E">, fn: signOut },
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">Popover</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;relative&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">PopoverButton
</span></span><span class="line" line="14"><span style="--shiki-default:#6F42C1">      class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;inline-flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900&quot;
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">    &gt;
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">AuthAvatar</span><span style="--shiki-default:#6F42C1"> :src</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;data?.user?.image&quot;</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">PopoverButton</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">transition
</span></span><span class="line" line="19"><span style="--shiki-default:#6F42C1">      enter-active-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;transition ease-out duration-200&quot;
</span></span><span class="line" line="20"><span style="--shiki-default:#6F42C1">      enter-from-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;opacity-0 translate-y-1&quot;
</span></span><span class="line" line="21"><span style="--shiki-default:#6F42C1">      enter-to-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;opacity-100 translate-y-0&quot;
</span></span><span class="line" line="22"><span style="--shiki-default:#6F42C1">      leave-active-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;transition ease-in duration-150&quot;
</span></span><span class="line" line="23"><span style="--shiki-default:#6F42C1">      leave-from-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;opacity-100 translate-y-0&quot;
</span></span><span class="line" line="24"><span style="--shiki-default:#6F42C1">      leave-to-class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;opacity-0 translate-y-1&quot;
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">    &gt;
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">PopoverPanel
</span></span><span class="line" line="27"><span style="--shiki-default:#6F42C1">        class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;absolute left-1/2 z-10 mt-2 flex w-screen max-w-min -translate-x-[90%] px-4&quot;
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">      &gt;
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">div
</span></span><span class="line" line="30"><span style="--shiki-default:#6F42C1">          class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;w-44 shrink rounded-xl bg-white p-4 text-sm font-semibold leading-6 text-gray-900 shadow-lg ring-1 ring-gray-900/5&quot;
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">        &gt;
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">         &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="33"><span style="--shiki-default:#6F42C1">            v-for</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;item in solutions&quot;
</span></span><span class="line" line="34"><span style="--shiki-default:#6F42C1">            :key</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;item.name&quot;
</span></span><span class="line" line="35"><span style="--shiki-default:#6F42C1">            @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;() =&gt; item.fn()&quot;
</span></span><span class="line" line="36"><span style="--shiki-default:#6F42C1">            class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;block p-2 hover:text-indigo-600&quot;
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">          &gt;
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">            {{ item.name }}
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">PopoverPanel</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">transition</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">Popover</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><h3 id="pricing-section"><a href="#pricing-section"><!--[-->Pricing Section<!--]--></a></h3><p><!--[-->Now, let&#39;s implement the <code class=""><!--[-->PricingSection<!--]--></code>, which contains the cards and the majority of the UI:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/PricingSection.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { CheckIcon } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@heroicons/vue/20/solid&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> handleBuyNow</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="8"><span style="--shiki-default:#6F42C1">    signIn</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> tiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  {
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">    name: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">    id: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">    href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">    priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$24&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    description: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">    features: [
</span></span><span class="line" line="19"><span style="--shiki-default:#032F62">      &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="20"><span style="--shiki-default:#032F62">      &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="21"><span style="--shiki-default:#032F62">      &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="22"><span style="--shiki-default:#032F62">      &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">    ],
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">    mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">  {
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">    name: </span><span style="--shiki-default:#032F62">&#39;Startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">    id: </span><span style="--shiki-default:#032F62">&#39;tier-startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">    href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">    priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$32&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">    description: </span><span style="--shiki-default:#032F62">&#39;A plan that scales with your rapidly growing business.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">    features: [
</span></span><span class="line" line="33"><span style="--shiki-default:#032F62">      &#39;25 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="34"><span style="--shiki-default:#032F62">      &#39;Up to 10,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="35"><span style="--shiki-default:#032F62">      &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="36"><span style="--shiki-default:#032F62">      &#39;24-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="37"><span style="--shiki-default:#032F62">      &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">    ],
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">    mostPopular: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">  {
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E">    name: </span><span style="--shiki-default:#032F62">&#39;Enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">    id: </span><span style="--shiki-default:#032F62">&#39;tier-enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">    href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="45"><span style="--shiki-default:#24292E">    priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$48&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E">    description: </span><span style="--shiki-default:#032F62">&#39;Dedicated support and infrastructure for your company.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">    features: [
</span></span><span class="line" line="48"><span style="--shiki-default:#032F62">      &#39;Unlimited products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="49"><span style="--shiki-default:#032F62">      &#39;Unlimited subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="50"><span style="--shiki-default:#032F62">      &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="51"><span style="--shiki-default:#032F62">      &#39;1-hour, dedicated support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="52"><span style="--shiki-default:#032F62">      &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="53"><span style="--shiki-default:#24292E">    ],
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E">    mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="55"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="56"><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="57"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="58"><span emptylineplaceholder="true">
</span></span><span class="line" line="59"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="60"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;bg-white py-10&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="61"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto max-w-7xl px-6 lg:px-8&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto max-w-4xl text-center&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">h2</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-base font-semibold leading-7 text-indigo-600&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E">          Pricing
</span></span><span class="line" line="65"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">h2</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="66"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="67"><span style="--shiki-default:#6F42C1">          class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-2 text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl&quot;
</span></span><span class="line" line="68"><span style="--shiki-default:#24292E">        &gt;
</span></span><span class="line" line="69"><span style="--shiki-default:#24292E">          Pricing plans for teams of</span><span style="--shiki-default:#005CC5">&amp;nbsp;</span><span style="--shiki-default:#24292E">all</span><span style="--shiki-default:#005CC5">&amp;nbsp;</span><span style="--shiki-default:#24292E">sizes
</span></span><span class="line" line="70"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="71"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="72"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="73"><span style="--shiki-default:#6F42C1">        class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto mt-6 max-w-2xl text-center text-lg leading-8 text-gray-600&quot;
</span></span><span class="line" line="74"><span style="--shiki-default:#24292E">      &gt;
</span></span><span class="line" line="75"><span style="--shiki-default:#24292E">        Distinctio et nulla eum soluta et neque labore quibusdam. Saepe et quasi
</span></span><span class="line" line="76"><span style="--shiki-default:#24292E">        iusto modi velit ut non voluptas in. Explicabo id ut laborum.
</span></span><span class="line" line="77"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="78"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div
</span></span><span class="line" line="79"><span style="--shiki-default:#6F42C1">        class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-y-8 sm:mt-20 lg:mx-0 lg:max-w-none lg:grid-cols-3&quot;
</span></span><span class="line" line="80"><span style="--shiki-default:#24292E">      &gt;
</span></span><span class="line" line="81"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">div
</span></span><span class="line" line="82"><span style="--shiki-default:#6F42C1">          v-for</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;(tier, tierIdx) in tiers&quot;
</span></span><span class="line" line="83"><span style="--shiki-default:#6F42C1">          :key</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="84"><span style="--shiki-default:#6F42C1">          :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="85"><span style="--shiki-default:#032F62">            tier.mostPopular ? &#39;lg:z-10 lg:rounded-b-none&#39; : &#39;lg:mt-8&#39;,
</span></span><span class="line" line="86"><span style="--shiki-default:#032F62">            tierIdx === 0 ? &#39;lg:rounded-r-none&#39; : &#39;&#39;,
</span></span><span class="line" line="87"><span style="--shiki-default:#032F62">            tierIdx === tiers.length - 1 ? &#39;lg:rounded-l-none&#39; : &#39;&#39;,
</span></span><span class="line" line="88"><span style="--shiki-default:#032F62">            &#39;flex flex-col justify-between rounded-3xl bg-white p-8 ring-1 ring-gray-200 xl:p-10&#39;,
</span></span><span class="line" line="89"><span style="--shiki-default:#032F62">          ]&quot;
</span></span><span class="line" line="90"><span style="--shiki-default:#24292E">        &gt;
</span></span><span class="line" line="91"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="92"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center justify-between gap-x-4&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="93"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">h3
</span></span><span class="line" line="94"><span style="--shiki-default:#6F42C1">                :id</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="95"><span style="--shiki-default:#6F42C1">                :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="96"><span style="--shiki-default:#032F62">                  tier.mostPopular ? &#39;text-indigo-600&#39; : &#39;text-gray-900&#39;,
</span></span><span class="line" line="97"><span style="--shiki-default:#032F62">                  &#39;text-lg font-semibold leading-8&#39;,
</span></span><span class="line" line="98"><span style="--shiki-default:#032F62">                ]&quot;
</span></span><span class="line" line="99"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="100"><span style="--shiki-default:#24292E">                {{ tier.name }}
</span></span><span class="line" line="101"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">h3</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="102"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="103"><span style="--shiki-default:#6F42C1">                v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.mostPopular&quot;
</span></span><span class="line" line="104"><span style="--shiki-default:#6F42C1">                class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;rounded-full bg-indigo-600/10 px-2.5 py-1 text-xs font-semibold leading-5 text-indigo-600&quot;
</span></span><span class="line" line="105"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="106"><span style="--shiki-default:#24292E">                Most popular
</span></span><span class="line" line="107"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="108"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="109"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-4 text-sm leading-6 text-gray-600&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="110"><span style="--shiki-default:#24292E">              {{ tier.description }}
</span></span><span class="line" line="111"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="112"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-6 flex items-baseline gap-x-1&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="113"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-4xl font-bold tracking-tight text-gray-900&quot;</span><span style="--shiki-default:#24292E">&gt;{{
</span></span><span class="line" line="114"><span style="--shiki-default:#24292E">                tier.priceMonthly
</span></span><span class="line" line="115"><span style="--shiki-default:#24292E">              }}&lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="116"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-sm font-semibold leading-6 text-gray-600&quot;
</span></span><span class="line" line="117"><span style="--shiki-default:#24292E">                &gt;/month&lt;/</span><span style="--shiki-default:#22863A">span
</span></span><span class="line" line="118"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="119"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="120"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">ul
</span></span><span class="line" line="121"><span style="--shiki-default:#6F42C1">              role</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;list&quot;
</span></span><span class="line" line="122"><span style="--shiki-default:#6F42C1">              class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-8 space-y-3 text-sm leading-6 text-gray-600&quot;
</span></span><span class="line" line="123"><span style="--shiki-default:#24292E">            &gt;
</span></span><span class="line" line="124"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">li
</span></span><span class="line" line="125"><span style="--shiki-default:#6F42C1">                v-for</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;feature in tier.features&quot;
</span></span><span class="line" line="126"><span style="--shiki-default:#6F42C1">                :key</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;feature&quot;
</span></span><span class="line" line="127"><span style="--shiki-default:#6F42C1">                class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex gap-x-3&quot;
</span></span><span class="line" line="128"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="129"><span style="--shiki-default:#24292E">                &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">CheckIcon
</span></span><span class="line" line="130"><span style="--shiki-default:#6F42C1">                  class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;h-6 w-5 flex-none text-indigo-600&quot;
</span></span><span class="line" line="131"><span style="--shiki-default:#6F42C1">                  aria-hidden</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;true&quot;
</span></span><span class="line" line="132"><span style="--shiki-default:#24292E">                /&gt;
</span></span><span class="line" line="133"><span style="--shiki-default:#24292E">                {{ feature }}
</span></span><span class="line" line="134"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">li</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="135"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">ul</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="136"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="137"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="138"><span style="--shiki-default:#6F42C1">            @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;handleBuyNow&quot;
</span></span><span class="line" line="139"><span style="--shiki-default:#6F42C1">            :aria-describedby</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="140"><span style="--shiki-default:#6F42C1">            :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="141"><span style="--shiki-default:#032F62">              tier.mostPopular
</span></span><span class="line" line="142"><span style="--shiki-default:#032F62">                ? &#39;bg-indigo-600 text-white shadow-sm hover:bg-indigo-500&#39;
</span></span><span class="line" line="143"><span style="--shiki-default:#032F62">                : &#39;text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:ring-indigo-300&#39;,
</span></span><span class="line" line="144"><span style="--shiki-default:#032F62">              &#39;mt-8 block rounded-md px-3 py-2 text-center text-sm font-semibold leading-6 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600&#39;,
</span></span><span class="line" line="145"><span style="--shiki-default:#032F62">            ]&quot;
</span></span><span class="line" line="146"><span style="--shiki-default:#24292E">          &gt;
</span></span><span class="line" line="147"><span style="--shiki-default:#24292E">            Buy plan
</span></span><span class="line" line="148"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="149"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="150"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="151"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="152"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="153"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->These component&#39;s are entirely UI-related right now with some auth-related logic sprinkled in. In later sections, we will expand on them and implement the Stripe-related code.<!--]--></p><h3 id="appvue"><a href="#appvue"><!--[-->App.vue<!--]--></a></h3><p><!--[-->One thing I like to do is place the <code class=""><!--[-->AuthMenu<!--]--></code> within my <code class=""><!--[-->app.vue<!--]--></code> file in my root. This ensures the user menu is available throughout the web application, giving users the ability to logout and manage their settings.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// app.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;right-4 top-4 absolute&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">AuthMenu</span><span style="--shiki-default:#6F42C1"> v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;status === &#39;authenticated&#39;&quot;</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#6F42C1"> v-else</span><span style="--shiki-default:#6F42C1"> @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;() =&gt; signIn(&#39;github&#39;)&quot;</span><span style="--shiki-default:#24292E">&gt;Sign In&lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">NuxtPage</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><h2 id="_05-stripe-customer"><a href="#_05-stripe-customer"><!--[-->05 - Stripe Customer<!--]--></a></h2><blockquote><!--[--><p><!--[-->Let&#39;s begin integrating Stripe into our Nuxt application<!--]--></p><!--]--></blockquote><p><!--[-->We&#39;re going to begin by creating a <a href="https://docs.stripe.com/api/customers" rel="nofollow"><!--[-->Stripe Customer<!--]--></a> when a user is created in our system, and syncing our data with Stripe&#39;s. The customer will maintain the relationship between our data and Stripe&#39;s and be how we access Stripe&#39;s endpoints.<!--]--></p><h3 id="stripe-environment-setup"><a href="#stripe-environment-setup"><!--[-->Stripe environment setup<!--]--></a></h3><p><!--[-->Like with most 3rd-party API&#39;s we integrate with, we will need to add a few API keys. We&#39;ll place these values into our <code class=""><!--[-->.env<!--]--></code> file.
The last time we worked with our <code class=""><!--[-->.env<!--]--></code> file, it looked like this:<!--]--></p><!--[--><pre class="language-bash shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1">//</span><span style="--shiki-default:#032F62"> .env
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">GITHUB_CLIENT_ID</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">AUTH_SECRET</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Let&#39;s add a few variables to this file:<!--]--></p><!--[--><pre class="language-bash shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D"># .env
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D"># OAUTH
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">GITHUB_CLIENT_ID</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D"># AUTH
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">AUTH_SECRET</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#6A737D"># DB
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">DATABASE_URL</span><span style="--shiki-default:#D73A49">=&lt;</span><span style="--shiki-default:#032F62">YOUR_VALUE</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#6A737D"># STRIPE
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">STRIPE_PUBLISHABLE_KEY</span><span style="--shiki-default:#D73A49">=
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">STRIPE_SECRET_KEY</span><span style="--shiki-default:#D73A49">=
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">STRIPE_WEBHOOK_SECRET_KEY</span><span style="--shiki-default:#D73A49">=
</span></span></code><!--]--></pre><!--]--><p><!--[--><strong><!--[-->Note:<!--]--></strong> When you ran <code class=""><!--[-->npx prisma init --datasource-provider sqlite<!--]--></code> earlier, the <code class=""><!--[-->DATABASE_URL<!--]--></code> value should have been generated. It&#39;s the a path to your database.<!--]--></p><p><!--[-->The new keys we&#39;ll be adding are <code class=""><!--[-->STRIPE_PUBLISHABLE_KEY<!--]--></code>, <code class=""><!--[-->STRIPE_SECRET_KEY<!--]--></code>, and <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code>.<!--]--></p><p><!--[-->To get these, navigate to <a href="https://stripe.com" rel="nofollow"><!--[-->stripe.com<!--]--></a> and create an account. You should then see a banner similar to this:<!--]--></p><p><!--[--><img src="https://cln.sh/1kcXgYJR+" alt="stripe banner|500"><!--]--></p><blockquote><!--[--><p><!--[-->The highlighted regions are the <code class=""><!--[-->STRIPE_PUBLISHABLE_KEY<!--]--></code> and <code class=""><!--[-->STRIPE_SECRET_KEY<!--]--></code> values.<!--]--></p><!--]--></blockquote><p><!--[--><strong><!--[-->Note:<!--]--></strong> We&#39;ll add the <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code> value in the next lesson.<!--]--></p><p><!--[-->With these environment variables in place, make sure to add them to your <code class=""><!--[-->runtimeConfig<!--]--></code> within your <code class=""><!--[-->nuxt.config.ts<!--]--></code> file:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> defineNuxtConfig</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  runtimeConfig: {
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">    AUTH_SECRET: process.env.</span><span style="--shiki-default:#005CC5">AUTH_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_ID: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_ID</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">    GITHUB_CLIENT_SECRET: process.env.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    STRIPE_PUBLISHABLE_KEY: process.env.</span><span style="--shiki-default:#005CC5">STRIPE_PUBLISHABLE_KEY</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">    STRIPE_WEBHOOK_SECRET_KEY: process.env.</span><span style="--shiki-default:#005CC5">STRIPE_WEBHOOK_SECRET_KEY</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    STRIPE_SECRET_KEY: process.env.</span><span style="--shiki-default:#005CC5">STRIPE_SECRET_KEY</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><h3 id="db-schema-changes"><a href="#db-schema-changes"><!--[-->DB Schema Changes<!--]--></a></h3><p><!--[-->We need to make a few minor adjustments to our Database&#39;s <code class=""><!--[-->Account<!--]--></code> table. We need a <code class=""><!--[-->stripe_customer_id<!--]--></code> value which connects our user&#39;s Account to Stripe so we can query <a href="https://docs.stripe.com/api/customers" rel="nofollow"><!--[-->customer endpoints<!--]--></a>. We&#39;re also going to use a basic <code class=""><!--[-->is_subscribed<!--]--></code> boolean to keep track of whether the user is subscribed or not.<!--]--></p><p><!--[-->Add these values to your <code class=""><!--[-->schema.prisma<!--]--></code> file:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">  stripe_customer_id String</span><span style="--shiki-default:#D73A49">?</span><span style="--shiki-default:#24292E"> @unique
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">  is_subscribed      Boolean @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">)
</span></span></code><!--]--></pre><!--]--><p><!--[-->Your <code class=""><!--[-->Account<!--]--></code> schema should now look like this:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// schema.prisma
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">model Account {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  id                String  @id @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#6F42C1">cuid</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  userId            String
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">  type</span><span style="--shiki-default:#6F42C1">              String
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">  provider          String
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  providerAccountId String
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  refresh_token     String?
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  access_token      String?
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  expires_at        Int?
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  token_type        String?
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  scope             String?
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  id_token          String?
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  session_state     String?
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  createdAt DateTime @default(now())
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">  updatedAt DateTime @updatedAt
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  stripe_customer_id String? @unique
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">  is_subscribed      Boolean @default(false)
</span></span><span class="line" line="21"><span emptylineplaceholder="true">
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">  @@unique([provider, providerAccountId])
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->After these changes, make sure to run <code class=""><!--[-->npx prisma generate<!--]--></code> and <code class=""><!--[-->npx prisma migrate dev<!--]--></code>. Name the migration whatever you think is appropriate.<!--]--></p><h3 id="stripe-util"><a href="#stripe-util"><!--[-->Stripe Util<!--]--></a></h3><p><!--[-->Create a file located at <code class=""><!--[-->server/util/stripe.ts<!--]--></code>. This is a simple utility file that will create a new stripe object that we will pass around our application as needed.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/util/stripe.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> Stripe </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;stripe&#39;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> const</span><span style="--shiki-default:#005CC5"> stripe</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> Stripe</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#6F42C1">useRuntimeConfig</span><span style="--shiki-default:#24292E">().</span><span style="--shiki-default:#005CC5">STRIPE_SECRET_KEY</span><span style="--shiki-default:#24292E">)
</span></span></code><!--]--></pre><!--]--><h3 id="create-customer-on-sign-up"><a href="#create-customer-on-sign-up"><!--[-->Create Customer on Sign Up<!--]--></a></h3><p><!--[-->The goal here is after we create a User&#39;s Account in our database we create the Stripe Customer and save the Stripe Customer&#39;s id in our Account table.<!--]--></p><p><!--[-->To do this, we need to hook into the <code class=""><!--[-->PrismaAdapter<!--]--></code> that is used within our <code class=""><!--[-->api/auth/[...].ts<!--]--></code> endpoint, and extend it to call Stripe&#39;s API.<!--]--></p><p><!--[-->In <span>...</span>.ts, import our stripe utility:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { stripe } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;~/server/utils/stripe&#39;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Then in our <code class=""><!--[-->NuxtAuthHandler<!--]--></code>, we need to use the spread operator on our <code class=""><!--[-->PrismaAdapter<!--]--></code> and override the <code class=""><!--[-->linkAccount<!--]--></code> function:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1"> adapter</span><span style="--shiki-default:#24292E">: {
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">    ...</span><span style="--shiki-default:#6F42C1">PrismaAdapter</span><span style="--shiki-default:#24292E">(prisma),
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">    async </span><span style="--shiki-default:#6F42C1">linkAccount</span><span style="--shiki-default:#24292E">(account) {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> user</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> prisma.user.</span><span style="--shiki-default:#6F42C1">findUniqueOrThrow</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">        where: { id: account.userId },
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">      if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">user.email) {
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49">        throw</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> Error</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;User email is required to create a Stripe customer&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="11"><span emptylineplaceholder="true">
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> customer</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> stripe.customers.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({ email: user.email })
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#D73A49">      return</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">        data: {
</span></span><span class="line" line="16"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">account,
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">          stripe_customer_id: customer.id,
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">  },
</span></span></code><!--]--></pre><!--]--><p><!--[-->You can read further into the <code class=""><!--[-->PrismaAdapter<!--]--></code>&#39;s source code on <a href="https://github.com/nextauthjs/next-auth/blob/main/packages/adapter-prisma/src/index.ts#L48" rel="nofollow"><!--[-->Github<!--]--></a>. It&#39;s simply running <code class=""><!--[-->p.account.create({ data })<!--]--></code>.
We extend this and first get the new user&#39;s email which is required to create a Stripe customer. With the newly acquired user&#39;s email, we create a stripe customer and then run:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">prisma.account.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">    data: {
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">        ...</span><span style="--shiki-default:#24292E">account,
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">        stripe_customer_id: customer.id,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->This is nearly the same as the original <code class=""><!--[-->linkAccount<!--]--></code> function, just with the addition of <code class=""><!--[-->stripe_customer_id: customer.id,<!--]--></code>.<!--]--></p><p><!--[-->Your <code class=""><!--[-->api/auth/[...].ts<!--]--></code> file should now look like this:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { NuxtAuthHandler } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;#auth&#39;
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaAdapter } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@next-auth/prisma-adapter&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { stripe } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;~/server/utils/stripe&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> runtimeConfig</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> useRuntimeConfig</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> NuxtAuthHandler</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  secret: runtimeConfig.</span><span style="--shiki-default:#005CC5">AUTH_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  adapter: {
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">    ...</span><span style="--shiki-default:#6F42C1">PrismaAdapter</span><span style="--shiki-default:#24292E">(prisma),
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">    async</span><span style="--shiki-default:#6F42C1"> linkAccount</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">account</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="14"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> user</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> prisma.user.</span><span style="--shiki-default:#6F42C1">findUniqueOrThrow</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">        where: { id: account.userId },
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="17"><span emptylineplaceholder="true">
</span></span><span class="line" line="18"><span style="--shiki-default:#D73A49">      if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">user.email) {
</span></span><span class="line" line="19"><span style="--shiki-default:#D73A49">        throw</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> Error</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;User email is required to create a Stripe customer&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="21"><span emptylineplaceholder="true">
</span></span><span class="line" line="22"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> customer</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> stripe.customers.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({ email: user.email })
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#D73A49">      return</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">        data: {
</span></span><span class="line" line="26"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">account,
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">          stripe_customer_id: customer.id,
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">  providers: [
</span></span><span class="line" line="33"><span style="--shiki-default:#6A737D">    // @ts-expect-error
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">    GithubProvider.</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">      clientId: runtimeConfig.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_ID</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">      clientSecret: runtimeConfig.</span><span style="--shiki-default:#005CC5">GITHUB_CLIENT_SECRET</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">    }),
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">  ],
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now, when you create an account, you should see the <code class=""><!--[-->stripe_customer_id<!--]--></code> column in your <code class=""><!--[-->Account<!--]--></code> database have a unique identifier. You can run <code class=""><!--[-->npx prisma studio<!--]--></code> to serve a a <a href="https://www.prisma.io/studio" rel="nofollow"><!--[-->Prisma Studio<!--]--></a> instance where you can view the data in your browser.<!--]--></p><p><!--[-->Navigate to <a href="https://dashboard.stripe.com/nuxt-stripe/customers" rel="nofollow"><!--[-->https://dashboard.stripe.com/nuxt-stripe/customers<!--]--></a> and you should see the Customer table with that a new value. If you click on the customer, you should see somewhere on that page a Customer ID with a value that matches what is in your database.<!--]--></p><h2 id="_06-stripe-checkout"><a href="#_06-stripe-checkout"><!--[-->06 - Stripe Checkout<!--]--></a></h2><p><!--[-->We&#39;re going to be using <a href="https://stripe.com/payments/checkout" rel="nofollow"><!--[-->Stripe Checkout<!--]--></a> for our payment flow. If you&#39;ve used Stripe in the past, this was probably the flow you used. We will run a function on our server that talks to Stripe and returns a URL.<!--]--></p><p><!--[-->This URL is then passed to our client and redirects users to a page that Stripe hosts. This page handles the transactions, billing information, and subscription information.<!--]--></p><h3 id="product"><a href="#product"><!--[-->Product<!--]--></a></h3><p><!--[-->Before we dive into code, we need to create the product that the user will purchase. Navigate to <a href="https://dashboard.stripe.com/nuxt-stripe/products" rel="nofollow"><!--[-->https://dashboard.stripe.com/nuxt-stripe/products<!--]--></a> and click <code class=""><!--[-->+ Add product<!--]--></code>.<!--]--></p><p><!--[-->I am using three different products in this project to match the three subscription tiers I plan to support: <code class=""><!--[-->startup<!--]--></code>, <code class=""><!--[-->freelance<!--]--></code>, and <code class=""><!--[-->enterprise<!--]--></code>. You may create as many products as you wish with the specific prices and details that match your needs.<!--]--></p><p><!--[-->What is <strong><!--[-->important<!--]--></strong> is clicking the More pricing options option in the Add product drawer. This will bring up a second drawer with a detailed view of our product. Scroll down a bit and you should see a <code class=""><!--[-->Lookup key<!--]--></code> set this to something logical. The lookup key for my Freelancer tier is <code class=""><!--[-->tier-freelancer<!--]--></code>. We will reference these keys in our code.<!--]--></p><h3 id="stripe-checkout-endpoint"><a href="#stripe-checkout-endpoint"><!--[-->Stripe Checkout Endpoint<!--]--></a></h3><blockquote><!--[--><p><!--[-->We&#39;ll start with the Checkout Session endpoint.<!--]--></p><!--]--></blockquote><p><!--[-->Create a file at <code class=""><!--[-->server/api/stripe/create-checkout-session.ts<!--]--></code> that contains the code:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// 1
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { stripe } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;~/server/utils/stripe&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { getServerSession } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;#auth&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> eventHandler</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#D73A49">async</span><span style="--shiki-default:#E36209"> event</span><span style="--shiki-default:#D73A49"> =&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D">  // 2
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">lookup_key</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> readBody</span><span style="--shiki-default:#24292E">(event)
</span></span><span class="line" line="11"><span style="--shiki-default:#6A737D">  // 3
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> authSession</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> getServerSession</span><span style="--shiki-default:#24292E">(event)
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (authSession </span><span style="--shiki-default:#D73A49">&amp;&amp;</span><span style="--shiki-default:#24292E"> authSession.user?.email) {
</span></span><span class="line" line="15"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> account</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">findFirst</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      where: {
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">        user: {
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">          email: authSession.user.email,
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="22"><span emptylineplaceholder="true">
</span></span><span class="line" line="23"><span style="--shiki-default:#6A737D">    // 4
</span></span><span class="line" line="24"><span style="--shiki-default:#D73A49">    if</span><span style="--shiki-default:#24292E"> (account </span><span style="--shiki-default:#D73A49">&amp;&amp;</span><span style="--shiki-default:#24292E"> account.stripe_customer_id </span><span style="--shiki-default:#D73A49">&amp;&amp;</span><span style="--shiki-default:#D73A49"> !</span><span style="--shiki-default:#24292E">account.is_subscribed) {
</span></span><span class="line" line="25"><span style="--shiki-default:#6A737D">     // 5
</span></span><span class="line" line="26"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> prices</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> stripe.prices.</span><span style="--shiki-default:#6F42C1">list</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">        lookup_keys: [lookup_key],
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">        expand: [</span><span style="--shiki-default:#032F62">&#39;data.product&#39;</span><span style="--shiki-default:#24292E">],
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="30"><span emptylineplaceholder="true">
</span></span><span class="line" line="31"><span style="--shiki-default:#6A737D">      // 6
</span></span><span class="line" line="32"><span style="--shiki-default:#D73A49">      const</span><span style="--shiki-default:#005CC5"> session</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> stripe.checkout.sessions.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">        customer: account.stripe_customer_id,         </span><span style="--shiki-default:#6A737D">// 6.1
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">        billing_address_collection: </span><span style="--shiki-default:#032F62">&#39;auto&#39;</span><span style="--shiki-default:#24292E">,           </span><span style="--shiki-default:#6A737D">// 6.2
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">        line_items: [                                 </span><span style="--shiki-default:#6A737D">// 6.3
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">          {
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">            price: prices.data[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].id,
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">            quantity: </span><span style="--shiki-default:#005CC5">1</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">          },
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">        ],
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">        mode: </span><span style="--shiki-default:#032F62">&#39;subscription&#39;</span><span style="--shiki-default:#24292E">,                         </span><span style="--shiki-default:#6A737D">// 6.4
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E">        success_url: </span><span style="--shiki-default:#032F62">`http://localhost:3000/success`</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#6A737D">// 6.5
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">        cancel_url: </span><span style="--shiki-default:#032F62">`http://localhost:3000/cancelled`</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="45"><span emptylineplaceholder="true">
</span></span><span class="line" line="46"><span style="--shiki-default:#D73A49">      if</span><span style="--shiki-default:#24292E"> (session.url) {
</span></span><span class="line" line="47"><span style="--shiki-default:#D73A49">        return</span><span style="--shiki-default:#24292E"> { url: session.url }
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="49"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->I understand this endpoint is a bit hefty, but I&#39;ll try my best to explain what it&#39;s doing:<!--]--></p><ol><!--[--><li><!--[-->We import the <code class=""><!--[-->stripe<!--]--></code> that&#39;s created in our <code class=""><!--[-->server/utils/stripe.ts<!--]--></code> file.<ul><!--[--><li><!--[-->This will be used to get the product and the checkout session.<!--]--></li><!--]--></ul><!--]--></li><li><!--[-->Within our endpoint (<code class=""><!--[-->eventHandler<!--]--></code>), we read from the request body.<ul><!--[--><li><!--[-->In our use case, <code class=""><!--[-->body<!--]--></code> is only used to acquire the <code class=""><!--[-->lookup_key<!--]--></code> so we de-structure the body object and extract the <code class=""><!--[-->lookup_key<!--]--></code> variable.<!--]--></li><!--]--></ul><!--]--></li><li><!--[-->We use Nuxt Auth&#39;s <a href="https://auth.sidebase.io/guide/authjs/server-side/session-access" rel="nofollow"><!--[-->getServerSession<!--]--></a> function to ensure whoever is calling this endpoint is logged in and save the session data into a variable.<ul><!--[--><li><!--[-->This session variable has the user&#39;s email, which we will use to get access to the <code class=""><!--[-->Account<!--]--></code> table which then gives us access to the <code class=""><!--[-->account.stripe_customer_id<!--]--></code>.<!--]--></li><!--]--></ul><!--]--></li><li><!--[-->We do a basic check <code class=""><!--[-->if (account &amp;&amp; account.stripe_customer_id &amp;&amp; !account.is_subscribed)<!--]--></code> to ensure the account exists, it has a stripe customer id, and it is not currently subscribed.<!--]--></li><li><!--[-->If this is the case, we run <code class=""><!--[-->stripe.prices.list()<!--]--></code> with the <code class=""><!--[-->lookup_key<!--]--></code> that is specific to our product to get the <strong><!--[-->prices<!--]--></strong> of the product.<ul><!--[--><li><!--[-->Prices is plural because this will eventually be used to manage monthly and/or yearly subscriptions.<!--]--></li><!--]--></ul><!--]--></li><li><!--[-->With the prices and <code class=""><!--[-->stripe_customer_id<!--]--></code>, we are able to call <code class=""><!--[-->stripe.checkout.sessions.create()<!--]--></code>.<ol><!--[--><li><!--[-->We set the customer to stripe_customer_id<!--]--></li><li><!--[--><code class=""><!--[-->billing_address_collection<!--]--></code> is set to <code class=""><!--[-->&#39;auto&#39;<!--]--></code>.<!--]--></li><li><!--[--><code class=""><!--[-->line_items<!--]--></code> is set to the price and quantity of the product we are selling. In this case, a single subscription.<!--]--></li><li><!--[--><code class=""><!--[-->mode<!--]--></code> defines the fact that we are selling a recurring subscription.<!--]--></li><li><!--[--><code class=""><!--[-->success_url<!--]--></code> and <code class=""><!--[-->cancel_url<!--]--></code> are defined to tell Stripe where to redirect users based on certain actions they interact with on the generated checkout page. We&#39;ll build these pages later on in this lesson.<!--]--></li><!--]--></ol><!--]--></li><!--]--></ol><h3 id="client-side-checkout"><a href="#client-side-checkout"><!--[-->Client-side Checkout<!--]--></a></h3><p><!--[-->With our endpoint setup, let&#39;s interact with it on the frontend. We&#39;ll implement this login within our <code class=""><!--[-->PricingSection.vue<!--]--></code> component.<!--]--></p><p><!--[-->I&#39;m able to encompass the majority of this logic with a new <code class=""><!--[-->checkout<!--]--></code> function:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// components/PricingSection.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D">  // 1
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> PRICE_LOOKUP_KEY</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#032F62"> &#39;tier-freelancer&#39;
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">  // 2
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> res</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> $fetch</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;/api/stripe/create-checkout-session&#39;</span><span style="--shiki-default:#24292E">, {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    method: </span><span style="--shiki-default:#032F62">&#39;POST&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">    body: {
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">      lookup_key: </span><span style="--shiki-default:#005CC5">PRICE_LOOKUP_KEY</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  })
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (res) {
</span></span><span class="line" line="14"><span style="--shiki-default:#6A737D">    // 3
</span></span><span class="line" line="15"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> navigateTo</span><span style="--shiki-default:#24292E">(res.url, {
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      external: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><ol><!--[--><li><!--[-->We are manually setting the lookup_key that we pass to our <code class=""><!--[-->create-checkout-session<!--]--></code> endpoint.
<ul><!--[--><li><!--[-->This will eventually be dynamic and adjust based on the card we click on.<!--]--></li><!--]--></ul><!--]--></li><li><!--[-->Here is a simple fetch request to our endpoint.<!--]--></li><li><!--[-->We use Nuxt&#39;s <a href="https://nuxt.com/docs/api/utils/navigate-to" rel="nofollow"><!--[-->navigateTo<!--]--></a> helper function with the <code class=""><!--[-->external<!--]--></code> option to redirect users to the url that&#39;s returned.<!--]--></li><!--]--></ol><p><!--[-->We then hook this in to our <code class=""><!--[-->handleBuyNow<!--]--></code> function:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// components/PricingSection.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> handleBuyNow</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">    signIn</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><h3 id="successcancel-pages"><a href="#successcancel-pages"><!--[-->Success/Cancel Pages<!--]--></a></h3><p><!--[-->Remember our <code class=""><!--[-->create-checkout-session<!--]--></code> endpoint had the following lines in the <code class=""><!--[-->stripe.sessions.create()<!--]--></code> function call?<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1">success_url</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">`http://localhost:3000/success`</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1">cancel_url</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">`http://localhost:3000/cancelled`</span><span style="--shiki-default:#24292E">,
</span></span></code><!--]--></pre><!--]--><p><!--[-->The <code class=""><!--[-->success<!--]--></code> and <code class=""><!--[-->cancelled<!--]--></code> pages are technically optional, but you do need to implement some client-side logic to handle the success and cancelled states that occur in the checkout session. So, we&#39;ll go the easy route and just create proper pages.<!--]--></p><ul><!--[--><li><!--[-->The success state is the page that Stripe redirects a user to after successfully subscribing.<!--]--></li><li><!--[-->The cancelled state is the page that Stripe redirects a user to after clicking the back button during the checkout session.<!--]--></li><!--]--></ul><p><!--[-->Let&#39;s create them.<!--]--></p><p><!--[-->In your <code class=""><!--[-->pages<!--]--></code> directory, create <code class=""><!--[-->success.vue<!--]--></code> and <code class=""><!--[-->cancelled.vue<!--]--></code> file.<!--]--></p><p><!--[-->I&#39;m not going to do anything creative here, and instead just be direct. I recommend in a proper production app you implement a nice UI state and flow for users that hit these pages.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// pages/success.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;Success!!&lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// pages/cancelled.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;Cancelled!!&lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><h3 id="stripe-checkout-page"><a href="#stripe-checkout-page"><!--[-->Stripe Checkout Page<!--]--></a></h3><p><!--[-->Now, when you&#39;re logged in and click a Buy plan button, you should see the Stripe Checkout page open:<!--]--></p><p><!--[--><img src="https://cln.sh/FZDtmlLr+" alt="checkout page|500"><!--]--></p><p><!--[-->You can fill in the form using Stripe&#39;s <a href="https://docs.stripe.com/testing" rel="nofollow"><!--[-->test card numbers<!--]--></a>. I typically use their Visa example because it&#39;s easy to remember: <code class=""><!--[-->4242424242424242<!--]--></code>.<!--]--></p><p><!--[-->When you properly fill in the form and click subscribe you should expect to see a few things:<!--]--></p><ol><!--[--><li><!--[-->You should be redirected to your <code class=""><!--[-->/success<!--]--></code> page.<!--]--></li><li><!--[-->You should see a new row in your Stripe Transactions located here: <a href="https://dashboard.stripe.com/nuxt-stripe/payments" rel="nofollow"><!--[-->https://dashboard.stripe.com/nuxt-stripe/payments<!--]--></a><!--]--></li><li><!--[-->You should <strong><!--[-->NOT<!--]--></strong> see <code class=""><!--[-->is_subscribed<!--]--></code> set to true in your database.<!--]--></li><!--]--></ol><p><!--[-->There is still some work to do before the subscription status is reflected in our application, but we are getting close. We now have the transaction taking place and are accepting money through Stripe. We are just missing the step where Stripe tells our server that a successful payment took place. We&#39;ll implement this in the next section.<!--]--></p><h2 id="_07-stripe-webhook"><a href="#_07-stripe-webhook"><!--[-->07 - Stripe Webhook<!--]--></a></h2><p><!--[-->We&#39;ll receive Stripe events by creating a webhook endpoint that Stripe can communicate through. (<a href="https://docs.stripe.com/webhooks" rel="nofollow"><!--[-->docs<!--]--></a>).<!--]--></p><p><!--[-->We&#39;ll need to populate the <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code> environment variable from earlier.<!--]--></p><h3 id="ngrok"><a href="#ngrok"><!--[-->Ngrok<!--]--></a></h3><p><!--[-->To do this, we&#39;ll need to expose our site to the web so that Stripe can access it.<!--]--></p><p><!--[-->My go-to for rapidly exposing my endpoints to the web is <a href="https://ngrok.com" rel="nofollow"><!--[-->ngrok<!--]--></a>. Download it <a href="https://ngrok.com/download" rel="nofollow"><!--[-->here<!--]--></a> and follow the documentation, get your auth token, and set up ngrok&#39;s CLI.<!--]--></p><p><!--[-->You should be able to run the following command in your terminal:<!--]--></p><!--[--><pre class="language-bash shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6F42C1">ngrok</span><span style="--shiki-default:#032F62"> http</span><span style="--shiki-default:#005CC5"> 3000
</span></span></code><!--]--></pre><!--]--><p><!--[--><strong><!--[-->Note:<!--]--></strong> Make sure your Nuxt application is running on port 3000 (the default port) before you run the ngrok command<!--]--></p><p><!--[-->Your terminal should now look like this:<!--]--></p><p><!--[--><img src="https://cln.sh/h2gqjQmz+" alt="ngrok terminal|500"><!--]--></p><p><!--[-->The <code class=""><!--[-->Forwarding<!--]--></code> URL is important. I&#39;m highlighting it here so that you see it. We will carry this over into the next section.<!--]--></p><h3 id="stripe_webhook_secret_key"><a href="#stripe_webhook_secret_key"><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></a></h3><p><!--[-->With our server online, navigate to <a href="https://dashboard.stripe.com/nuxt-stripe/webhooks" rel="nofollow"><!--[-->https://dashboard.stripe.com/nuxt-stripe/webhooks<!--]--></a> and click <code class=""><!--[-->+ Add endpoint<!--]--></code> and add the following:<!--]--></p><p><!--[--><code class=""><!--[-->Endpoint URL<!--]--></code>: Paste the ngrok <code class=""><!--[-->Forwarding<!--]--></code> url from earlier. Then, add <code class=""><!--[-->/api/stripe/webhook<!--]--></code> to the end. This endpoint hasn&#39;t been created yet, but we will take care of that soon.<!--]--></p><p><!--[--><code class=""><!--[-->Description<!--]--></code> is optional.<!--]--></p><p><!--[--><code class=""><!--[-->Listen to<!--]--></code>: Events on your account<!--]--></p><p><!--[--><code class=""><!--[-->Select events to listen to<!--]--></code>: Click <code class=""><!--[-->+ Select events<!--]--></code> and search for <em><!--[-->subscription<!--]--></em>. Toggle on <code class=""><!--[-->customer.subscription.created<!--]--></code> and <code class=""><!--[-->customer.subscription.deleted<!--]--></code> and click <code class=""><!--[-->Add events<!--]--></code>.<!--]--></p><p><!--[-->Your form should similar to this:<!--]--></p><p><!--[--><img src="https://cln.sh/W9ZDN7Cm+" alt="Stripe events webhook|500"><!--]--></p><p><!--[-->Now submit the form with <code class=""><!--[-->Add endpoint<!--]--></code>.<!--]--></p><p><!--[-->This should redirect you to a details page on Stripe for your newly submitted Webhook. Look for <code class=""><!--[-->Signing secret<!--]--></code> and click <code class=""><!--[-->Reveal<!--]--></code>. The value that is shown is your <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code>. Copy and paste it into your <code class=""><!--[-->.env<!--]--></code> file.<!--]--></p><h3 id="webhook-endpoint"><a href="#webhook-endpoint"><!--[-->Webhook Endpoint<!--]--></a></h3><p><!--[-->This one may seem a bit meaty, but a good portion of it is simple error handling. I&#39;ll try my best to explain the code snippet to you:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/stripe/webhook.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { stripe } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;~/server/utils/stripe&#39;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> runtimeConfig</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> useRuntimeConfig</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> eventHandler</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#D73A49">async</span><span style="--shiki-default:#E36209"> event</span><span style="--shiki-default:#D73A49"> =&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D">  // 1
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> body</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> readRawBody</span><span style="--shiki-default:#24292E">(event, </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">  let</span><span style="--shiki-default:#24292E"> stripeEvent</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> any</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> body
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">  let</span><span style="--shiki-default:#24292E"> subscription
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">  let</span><span style="--shiki-default:#24292E"> status
</span></span><span class="line" line="14"><span style="--shiki-default:#6A737D">  // 2
</span></span><span class="line" line="15"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> signature</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> getHeader</span><span style="--shiki-default:#24292E">(event, </span><span style="--shiki-default:#032F62">&#39;stripe-signature&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">body) {
</span></span><span class="line" line="18"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#24292E"> { error: </span><span style="--shiki-default:#032F62">&#39;Invalid request body&#39;</span><span style="--shiki-default:#24292E"> }
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="20"><span emptylineplaceholder="true">
</span></span><span class="line" line="21"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">signature) {
</span></span><span class="line" line="22"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#24292E"> { error: </span><span style="--shiki-default:#032F62">&#39;Invalid stripe-signature&#39;</span><span style="--shiki-default:#24292E"> }
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span style="--shiki-default:#D73A49">  try</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="26"><span style="--shiki-default:#6A737D">    // 3
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">    stripeEvent </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripe.webhooks.</span><span style="--shiki-default:#6F42C1">constructEvent</span><span style="--shiki-default:#24292E">(
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">      body,
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      signature,
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">      runtimeConfig.</span><span style="--shiki-default:#005CC5">STRIPE_WEBHOOK_SECRET_KEY
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">    )
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">catch</span><span style="--shiki-default:#24292E"> (err) {
</span></span><span class="line" line="33"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> error</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> createError</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">      statusCode: </span><span style="--shiki-default:#005CC5">400</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">      statusMessage: </span><span style="--shiki-default:#032F62">`Webhook error: ${</span><span style="--shiki-default:#24292E">err</span><span style="--shiki-default:#032F62">}`</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="37"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#6F42C1"> sendError</span><span style="--shiki-default:#24292E">(event, error)
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="39"><span style="--shiki-default:#6A737D">  // 4
</span></span><span class="line" line="40"><span style="--shiki-default:#D73A49">  switch</span><span style="--shiki-default:#24292E"> (stripeEvent.type) {
</span></span><span class="line" line="41"><span style="--shiki-default:#6A737D">    // 5
</span></span><span class="line" line="42"><span style="--shiki-default:#D73A49">    case</span><span style="--shiki-default:#032F62"> &#39;customer.subscription.deleted&#39;</span><span style="--shiki-default:#24292E">:
</span></span><span class="line" line="43"><span style="--shiki-default:#24292E">      subscription </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">      status </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> subscription.status
</span></span><span class="line" line="45"><span emptylineplaceholder="true">
</span></span><span class="line" line="46"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">update</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">        where: {
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">          stripe_customer_id: subscription.customer,
</span></span><span class="line" line="49"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">        data: {
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">          is_subscribed: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="52"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="53"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="54"><span emptylineplaceholder="true">
</span></span><span class="line" line="55"><span style="--shiki-default:#D73A49">      break
</span></span><span class="line" line="56"><span style="--shiki-default:#6A737D">    // 6
</span></span><span class="line" line="57"><span style="--shiki-default:#D73A49">    case</span><span style="--shiki-default:#032F62"> &#39;customer.subscription.created&#39;</span><span style="--shiki-default:#24292E">:
</span></span><span class="line" line="58"><span style="--shiki-default:#24292E">      subscription </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object
</span></span><span class="line" line="59"><span style="--shiki-default:#24292E">      status </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> subscription.status
</span></span><span class="line" line="60"><span emptylineplaceholder="true">
</span></span><span class="line" line="61"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">update</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">        where: {
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">          stripe_customer_id: subscription.customer,
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="65"><span style="--shiki-default:#24292E">        data: {
</span></span><span class="line" line="66"><span style="--shiki-default:#24292E">          is_subscribed: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="67"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="68"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="69"><span emptylineplaceholder="true">
</span></span><span class="line" line="70"><span style="--shiki-default:#D73A49">      break
</span></span><span class="line" line="71"><span style="--shiki-default:#D73A49">    default</span><span style="--shiki-default:#24292E">:
</span></span><span class="line" line="72"><span style="--shiki-default:#24292E">      console.</span><span style="--shiki-default:#6F42C1">log</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">`Unhandled event type ${</span><span style="--shiki-default:#24292E">stripeEvent</span><span style="--shiki-default:#032F62">.</span><span style="--shiki-default:#24292E">type</span><span style="--shiki-default:#032F62">}.`</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="73"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="74"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#24292E"> { received: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E"> }
</span></span><span class="line" line="75"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><blockquote><!--[--><p><!--[-->At this point, I assume you are familiar with useRuntimeConfig, Prisma, and Stripe constants.<!--]--></p><!--]--></blockquote><ol><!--[--><li><!--[--><a href="https://h3.unjs.io/utils/request#readrawbodyevent-encoding" rel="nofollow"><!--[-->readRawBody<!--]--></a> - Stripe requires the raw body when running <code class=""><!--[-->stripe.webhooks.constructEvent()<!--]--></code>, so we use <code class=""><!--[-->readRawBody<!--]--></code> here. The second parameter, <code class=""><!--[-->false<!--]--></code>, returns it as a <code class=""><!--[-->Buffer<!--]--></code>.<!--]--></li><li><!--[--><code class=""><!--[-->stripe-signature<!--]--></code> - Stripe will send us this header which is passed to the <code class=""><!--[-->constructEvent<!--]--></code> function.<!--]--></li><li><!--[-->We pass the <code class=""><!--[-->body<!--]--></code>, <code class=""><!--[-->signature<!--]--></code>, and <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code> to construct the Webhook that Stripe sent to us.<!--]--></li><li><!--[-->Now we create a switch statement against the stripe event. I&#39;m only interested in the <code class=""><!--[-->customer.subscription.deleted<!--]--></code> and <code class=""><!--[-->customer.subscription.created<!--]--></code> events, but you can extend this to receive any of the events listed during the <code class=""><!--[-->STRIPE_WEBHOOK_SECRET_KEY<!--]--></code> setup.<!--]--></li><li><!--[-->On the <code class=""><!--[-->customer.subscription.deleted<!--]--></code> event, we find the <code class=""><!--[-->Account<!--]--></code> that contains the <code class=""><!--[-->stripe_customer_id<!--]--></code> that matches the subscription&#39;s customer id. Then we update the <code class=""><!--[-->is_subscribed<!--]--></code> value to false.<!--]--></li><li><!--[-->On the <code class=""><!--[-->customer.subscription.created<!--]--></code> event, we do the same, just this time we update <code class=""><!--[-->is_subscribed<!--]--></code> value to true.<!--]--></li><!--]--></ol><p><!--[-->With this in place, you should be able to go through the Stripe Checkout form and this time, when you successfully submit it, your webhook&#39;s detail page should show the <code class=""><!--[-->customer.subscription.created<!--]--></code> event log:<!--]--></p><p><!--[--><img src="https://cln.sh/b0scQrQ5+" alt="subscription created log|700"><!--]--></p><blockquote><!--[--><p><!--[-->It should be successful, but if it&#39;s not, read the logs. 99% of the time, it&#39;s an API key issue.<!--]--></p><!--]--></blockquote><p><!--[-->With a successful creation webhook event, you should now see <code class=""><!--[-->is_subscribed<!--]--></code> is <code class=""><!--[-->true<!--]--></code> within your Database&#39;s Account table.<!--]--></p><p><!--[--><img src="https://cln.sh/fZbV8B7q+" alt="is subscribed true|500"><!--]--></p><p><!--[-->With this in place, we have successfully implemented a basic subscription system. In the next few sections we will expand on this further to allow our users to manage their subscriptions in a Stripe Portal, chose between multiple subscription tiers, chose between yearly and monthly with dynamic pricing, and manage site permissions based on the subscription chosen.<!--]--></p><h2 id="_08-stripe-customer-portal"><a href="#_08-stripe-customer-portal"><!--[-->08 - Stripe Customer Portal<!--]--></a></h2><p><!--[-->The next step in our Stripe integration is subscription management. We&#39;re accepting users money and updating their subscription status in our database to reflect whether they&#39;ve paid or not.<!--]--></p><p><!--[-->Now we need to give users the ability to manage their subscription. This includes cancelling it, changing their payment method, and seeing their payment history.<!--]--></p><p><!--[-->Luckily for us, the majority of this is taken care of within Stripe. Similar to the Checkout experience, we  need to create the dashboard session url and redirect our users to it.<!--]--></p><h3 id="generate-billingportal-url"><a href="#generate-billingportal-url"><!--[-->Generate BillingPortal URL<!--]--></a></h3><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/stripe/create-portal-session.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { stripe } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;~/server/utils/stripe&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { getServerSession } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;#auth&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> baseUrl</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#032F62"> &#39;http://localhost:3000&#39;
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> eventHandler</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#D73A49">async</span><span style="--shiki-default:#E36209"> event</span><span style="--shiki-default:#D73A49"> =&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> session</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> getServerSession</span><span style="--shiki-default:#24292E">(event)
</span></span><span class="line" line="11"><span emptylineplaceholder="true">
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">session?.user?.email) {
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#24292E"> { error: </span><span style="--shiki-default:#032F62">&#39;User not authenticated&#39;</span><span style="--shiki-default:#24292E"> }
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> account</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">findFirst</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    where: {
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">      user: {
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">        email: session.user.email,
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">  })
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line" line="24"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#D73A49">!</span><span style="--shiki-default:#24292E">account?.stripe_customer_id) {
</span></span><span class="line" line="25"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#24292E"> { error: </span><span style="--shiki-default:#032F62">&#39;Stripe customer not found&#39;</span><span style="--shiki-default:#24292E"> }
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="27"><span style="--shiki-default:#6A737D">  // 1
</span></span><span class="line" line="28"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> portalSession</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> stripe.billingPortal.sessions.</span><span style="--shiki-default:#6F42C1">create</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">    customer: account.stripe_customer_id,
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">    return_url: baseUrl,
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">  })
</span></span><span class="line" line="32"><span emptylineplaceholder="true">
</span></span><span class="line" line="33"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#24292E"> { url: portalSession.url }
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->I&#39;m assuming most of this is getting repetitive and you understand it. But a quick refresher, we get the auth session to ensure the user is logged in and then get their Account so we have access to <code class=""><!--[-->stripe_customer_id<!--]--></code>.<!--]--></p><ol><!--[--><li><!--[-->With <code class=""><!--[-->stripe_customer_id<!--]--></code>, we call <code class=""><!--[-->stripe.billingPortal.sessions.create()<!--]--></code> which generates a URL that we can navigate to on the frontend.<!--]--></li><!--]--></ol><h3 id="usestripe-composable"><a href="#usestripe-composable"><!--[-->useStripe Composable<!--]--></a></h3><p><!--[-->Consuming this endpoint and navigating to the billing portal is straight forward and very similar to the checkout experience:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> navigateToStripeDashboard</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> res</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> $fetch</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;/api/stripe/create-portal-session&#39;</span><span style="--shiki-default:#24292E">, {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">      method: </span><span style="--shiki-default:#032F62">&#39;POST&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">    if</span><span style="--shiki-default:#24292E"> (res </span><span style="--shiki-default:#D73A49">&amp;&amp;</span><span style="--shiki-default:#032F62"> &#39;url&#39;</span><span style="--shiki-default:#D73A49"> in</span><span style="--shiki-default:#24292E"> res) {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#6F42C1"> navigateTo</span><span style="--shiki-default:#24292E">(res.url, {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">        external: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">    } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">      console.</span><span style="--shiki-default:#6F42C1">error</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;Error creating portal session:&#39;</span><span style="--shiki-default:#24292E">, res.error)
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->But at this stage, our <code class=""><!--[-->PricingSection<!--]--></code> component is becoming a bit cluttered, so I decided to move the Stripe-specific functions into a <a href="https://vuejs.org/guide/reusability/composables" rel="nofollow"><!--[-->composable<!--]--></a> called <code class=""><!--[-->useStripe<!--]--></code>.<!--]--></p><p><!--[-->Create a new directory called <code class=""><!--[-->composables<!--]--></code> and within it a file called <code class=""><!--[-->useStripe<!--]--></code>.<!--]--></p><p><!--[-->Extract the checkout function and the tiers from <code class=""><!--[-->PricingSection<!--]--></code> and place them along with our new <code class=""><!--[-->navigateToStripeDashboard<!--]--></code> function into our new file.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// composables/useStripe
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> function</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">() {
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> PRICE_LOOKUP_KEY</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#032F62"> &#39;tier-freelancer&#39;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> res</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> $fetch</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;/api/stripe/create-checkout-session&#39;</span><span style="--shiki-default:#24292E">, {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">      method: </span><span style="--shiki-default:#032F62">&#39;POST&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      body: {
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">        lookup_key: </span><span style="--shiki-default:#005CC5">PRICE_LOOKUP_KEY</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="12"><span emptylineplaceholder="true">
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">    if</span><span style="--shiki-default:#24292E"> (res) {
</span></span><span class="line" line="14"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#6F42C1"> navigateTo</span><span style="--shiki-default:#24292E">(res.url, {
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">        external: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#6F42C1"> navigateToStripeDashboard</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="21"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> res</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> $fetch</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;/api/stripe/create-portal-session&#39;</span><span style="--shiki-default:#24292E">, {
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">      method: </span><span style="--shiki-default:#032F62">&#39;POST&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="24"><span emptylineplaceholder="true">
</span></span><span class="line" line="25"><span style="--shiki-default:#D73A49">    if</span><span style="--shiki-default:#24292E"> (res </span><span style="--shiki-default:#D73A49">&amp;&amp;</span><span style="--shiki-default:#032F62"> &#39;url&#39;</span><span style="--shiki-default:#D73A49"> in</span><span style="--shiki-default:#24292E"> res) {
</span></span><span class="line" line="26"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#6F42C1"> navigateTo</span><span style="--shiki-default:#24292E">(res.url, {
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">        external: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">    } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">      console.</span><span style="--shiki-default:#6F42C1">error</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;Error creating portal session:&#39;</span><span style="--shiki-default:#24292E">, res.error)
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="33"><span emptylineplaceholder="true">
</span></span><span class="line" line="34"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#005CC5"> tiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$24&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="42"><span style="--shiki-default:#032F62">        &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="43"><span style="--shiki-default:#032F62">        &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="44"><span style="--shiki-default:#032F62">        &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="45"><span style="--shiki-default:#032F62">        &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="49"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="52"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="53"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$32&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;A plan that scales with your rapidly growing business.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="55"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="56"><span style="--shiki-default:#032F62">        &#39;25 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="57"><span style="--shiki-default:#032F62">        &#39;Up to 10,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="58"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="59"><span style="--shiki-default:#032F62">        &#39;24-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="60"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="61"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="65"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="66"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="67"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="68"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$48&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="69"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;Dedicated support and infrastructure for your company.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="70"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="71"><span style="--shiki-default:#032F62">        &#39;Unlimited products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="72"><span style="--shiki-default:#032F62">        &#39;Unlimited subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="73"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="74"><span style="--shiki-default:#032F62">        &#39;1-hour, dedicated support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="75"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="76"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="77"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="78"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="79"><span style="--shiki-default:#24292E">  ]
</span></span><span class="line" line="80"><span emptylineplaceholder="true">
</span></span><span class="line" line="81"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#24292E"> { checkout, navigateToStripeDashboard, tiers }
</span></span><span class="line" line="82"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now, we can easily re-use these functions throughout our application. You may notice that we&#39;ve been using a composable this entire time with <code class=""><!--[-->useAuth<!--]--></code>.<!--]--></p><p><!--[-->We&#39;ll start using it in our <code class=""><!--[-->AuthMenu<!--]--></code> component. Extract the <code class=""><!--[-->navigateToeStripeDashboard<!--]--></code> function from the <code class=""><!--[-->useStripe<!--]--></code> composable:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">navigateToStripeDashboard</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">()
</span></span></code><!--]--></pre><!--]--><p><!--[-->Then update the <code class=""><!--[-->solutions<!--]--></code> array, replacing the Manage Billing object&#39;s function with our newly defined <code class=""><!--[-->navigateToStripeDashboard<!--]--></code>.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/AuthMenu.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">...
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signOut</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">navigateToStripeDashboard</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> solutions</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Manage Billing&#39;</span><span style="--shiki-default:#24292E">, fn: navigateToStripeDashboard },
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Sign Out&#39;</span><span style="--shiki-default:#24292E">, fn: signOut },
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    ...
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now, when you click the <code class=""><!--[-->Manage Billing<!--]--></code> button within your <code class=""><!--[-->AuthMenu<!--]--></code> dropdown, it should navigate you to a <code class=""><!--[-->billing.stripe.com<!--]--></code> url.<!--]--></p><p><!--[--><img src="https://cln.sh/TBQ7mHth+" alt="stripe billing portal|500"><!--]--></p><p><!--[-->Here you can update or cancel your plan!<!--]--></p><h2 id="_09-composable-refactor"><a href="#_09-composable-refactor"><!--[-->09 - Composable Refactor<!--]--></a></h2><h3 id="issubscribed-check"><a href="#issubscribed-check"><!--[-->isSubscribed Check<!--]--></a></h3><p><!--[-->I want to check against the <code class=""><!--[-->isSubscribed<!--]--></code> value we have attached to our user&#39;s Account to dynamically render content based on this value.<!--]--></p><p><!--[-->To do this, we&#39;re going to tap into Authjs&#39; <a href="https://next-auth.js.org/configuration/callbacks#session-callback" rel="nofollow"><!--[-->session callback<!--]--></a>. The session callback is ran whenever a session is checked.<!--]--></p><p><!--[-->Navigate to our <code class=""><!--[-->api/auth/[...]ts<!--]--></code> file and add a <code class=""><!--[-->callback<!--]--></code> within our <code class=""><!--[-->NuxtAuthHandler<!--]--></code>:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// api/auth/[...].ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> default</span><span style="--shiki-default:#6F42C1"> NuxtAuthHandler</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">  ...</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  callbacks: {
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">    // Adding subscription status to default useAuth data object.
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">    async</span><span style="--shiki-default:#6F42C1"> session</span><span style="--shiki-default:#24292E">({ </span><span style="--shiki-default:#E36209">session</span><span style="--shiki-default:#24292E"> }) {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">      if</span><span style="--shiki-default:#24292E"> (session.user?.email) {
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">        const</span><span style="--shiki-default:#005CC5"> accounts</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> getAccountsByEmail</span><span style="--shiki-default:#24292E">(session.user.email)
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">        return</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">session,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">          user: {
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">            ...</span><span style="--shiki-default:#24292E">session.user,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">            isSubscribed: accounts[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].is_subscribed,
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">          },
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">        }
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span style="--shiki-default:#D73A49">      return</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49">        ...</span><span style="--shiki-default:#24292E">session,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">        user: {
</span></span><span class="line" line="22"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">session.user,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">          isSubscribed: </span><span style="--shiki-default:#005CC5">undefined</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">  },
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">if</span><span style="--shiki-default:#24292E"> (session.user?.email) {
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> accounts</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> getAccountsByEmail</span><span style="--shiki-default:#24292E">(session.user.email)
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">      ...</span><span style="--shiki-default:#24292E">session,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      user: {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">        ...</span><span style="--shiki-default:#24292E">session.user,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">        isSubscribed: accounts[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].is_subscribed,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->This is checking if the user is logged in and if it does, it queries for the user&#39;s Account. Once we have the Account, we return the <code class=""><!--[-->...session<!--]--></code>, which is the default returned object, but we go into it&#39;s nested <code class=""><!--[-->user<!--]--></code> object and extend it with <code class=""><!--[-->isSubscribed: accounts[0].is_subscribed<!--]--></code>.<!--]--></p><p><!--[-->Here I am using a utility query called <code class=""><!--[-->getAccountsByEmail<!--]--></code>. Create a file at <code class=""><!--[-->server/utils/queries/getAccountsByEmail.ts<!--]--></code> and in it, the code:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/utils/queries/getAccountsByEmail.ts`
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { PrismaClient } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@prisma/client&#39;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> prisma</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> new</span><span style="--shiki-default:#6F42C1"> PrismaClient</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> const</span><span style="--shiki-default:#6F42C1"> getAccountsByEmail</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#E36209">email</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#24292E">) </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">findMany</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    where: {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      user: {
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">        email: email,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  })
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->It&#39;s a basic Prisma query. But I can see myself using this one often so I decided to extract it into its own function.<!--]--></p><p><!--[-->Now, when we run extract <code class=""><!--[-->data<!--]--></code> from <code class=""><!--[-->useAuth<!--]--></code> and navigate through the <code class=""><!--[-->data<!--]--></code> object to get the <code class=""><!--[-->isSubscribed<!--]--></code> value::<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">data.value?.user?.isSubscribed
</span></span></code><!--]--></pre><!--]--><p><!--[-->I use this in our <code class=""><!--[-->PricingSection<!--]--></code> component to adjust the pricing card&#39;s text and functionality.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/PricingSection.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">checkout</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">navigateToStripeDashboard</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">tiers</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> handleBuyNow</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> () </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (data.value?.user?.isSubscribed) {
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> navigateToStripeDashboard</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#D73A49"> if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="12"><span style="--shiki-default:#6F42C1">    signIn</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="15"><span emptylineplaceholder="true">
</span></span><span class="line" line="16"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> buttonText</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> computed</span><span style="--shiki-default:#24292E">(() </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="17"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (data.value?.user?.isSubscribed) {
</span></span><span class="line" line="18"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Manage Subscription&#39;
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#D73A49"> if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Buy Now&#39;
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="22"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Sign In to Buy&#39;
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">})
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">...
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="30"><span style="--shiki-default:#6F42C1">    @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;handleBuyNow&quot;
</span></span><span class="line" line="31"><span style="--shiki-default:#6F42C1">    :aria-describedby</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="32"><span style="--shiki-default:#6F42C1">    :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;...&quot;
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">    {{ buttonText }}
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">...
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->I cut away the majority of the html and css here, just to showcase the button&#39;s dynamic <code class=""><!--[-->handleBuyNow<!--]--></code> function and computed <code class=""><!--[-->buttonText<!--]--></code>.<!--]--></p><p><!--[-->Now, if the user is subscribed, the button will say &quot;Manage Subscription&quot; and clicking it will navigate the user to the Billing Portal.<!--]--></p><p><!--[-->If the user is logged in but not subscribed, it will say &quot;Buy Now&quot; and navigate the user to the Checkout Portal.<!--]--></p><p><!--[-->If the user is not logged in, it will say &quot;Sign in to Buy&quot; and clicking it will log the user in.<!--]--></p><h3 id="typescript-adjustment"><a href="#typescript-adjustment"><!--[-->Typescript adjustment<!--]--></a></h3><p><!--[-->If you&#39;re using Typescript, you may see a few red lines yelling at you. This is because we are extending the Auth&#39;s User object within the Session Callback, but we are not informing our client side Typescript that this is happening.<!--]--></p><p><!--[-->To clean this up and make Typescript happy, create a file at <code class=""><!--[-->types/next-auth.d.ts<!--]--></code> and add the following code:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// types/next-auth.d.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">mport NextAuth, { DefaultSession } from </span><span style="--shiki-default:#032F62">&#39;next-auth&#39;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">declare</span><span style="--shiki-default:#D73A49"> module</span><span style="--shiki-default:#032F62"> &#39;next-auth&#39;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">  /**
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D">   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider`
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">   */
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">  interface</span><span style="--shiki-default:#6F42C1"> Session</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#E36209">    user</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="10"><span style="--shiki-default:#6A737D">      /** The user&#39;s Stripe subscription status. */
</span></span><span class="line" line="11"><span style="--shiki-default:#E36209">      isSubscribed</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> boolean
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    } </span><span style="--shiki-default:#D73A49">&amp;</span><span style="--shiki-default:#6F42C1"> DefaultSession</span><span style="--shiki-default:#24292E">[</span><span style="--shiki-default:#032F62">&#39;user&#39;</span><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->This overrides the <code class=""><!--[-->Session<!--]--></code> interface defined by next-auth and extends it with the <code class=""><!--[-->user.isSubscribed<!--]--></code> field.<!--]--></p><h2 id="_10-multiple-plans"><a href="#_10-multiple-plans"><!--[-->10 - Multiple Plans<!--]--></a></h2><p><!--[-->Awhile back I mentioned we would get rid of the hard coded <code class=""><!--[-->PRICE_LOOKUP_KEY<!--]--></code>. The reason we don&#39;t like it is because it&#39;s limiting our checkout to a single subscription plan. Our goal is to support multiple prices and plans, so let&#39;s make the necessary adjustments.<!--]--></p><h3 id="multiple-products"><a href="#multiple-products"><!--[-->Multiple Products<!--]--></a></h3><p><!--[-->Before digging into the code we need to add additional products in our Stripe dashboard.<!--]--></p><p><!--[-->Navigate to Stripe&#39;s <a href="https://dashboard.stripe.com/nuxt-stripe/products?active=true" rel="nofollow"><!--[-->Product catalog<!--]--></a> and add two additional products. Ensure your product&#39;s information matches whatever you have within <code class=""><!--[-->composables/useStripe<!--]--></code>&#39;s tiers object.<!--]--></p><p><!--[-->Here is my <code class=""><!--[-->tiers<!--]--></code> for reference:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// composables/useStripe
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> tiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$24&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="10"><span style="--shiki-default:#032F62">        &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="11"><span style="--shiki-default:#032F62">        &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#032F62">        &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="13"><span style="--shiki-default:#032F62">        &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$32&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;A plan that scales with your rapidly growing business.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="24"><span style="--shiki-default:#032F62">        &#39;25 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="25"><span style="--shiki-default:#032F62">        &#39;Up to 10,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="26"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="27"><span style="--shiki-default:#032F62">        &#39;24-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="28"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">      priceMonthly: </span><span style="--shiki-default:#032F62">&#39;$48&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;Dedicated support and infrastructure for your company.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="39"><span style="--shiki-default:#032F62">        &#39;Unlimited products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="40"><span style="--shiki-default:#032F62">        &#39;Unlimited subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="41"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="42"><span style="--shiki-default:#032F62">        &#39;1-hour, dedicated support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="43"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="44"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="45"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">  ]
</span></span></code><!--]--></pre><!--]--><p><!--[-->Ensure the new products you create have a <code class=""><!--[-->lookup_key<!--]--></code> that matches the <code class=""><!--[-->tier<!--]--></code>  object&#39;s <code class=""><!--[-->id<!--]--></code> field.
In my case, I have <code class=""><!--[-->tier-freelancer<!--]--></code>, <code class=""><!--[-->tier-startup<!--]--></code>, and <code class=""><!--[-->tier-enterprise<!--]--></code>.<!--]--></p><p><!--[-->Also ensure the rest of the data matches what you create in Stripe&#39;s dashboard i.e. Price, name, etc.<!--]--></p><h3 id="code-adjustments"><a href="#code-adjustments"><!--[-->Code Adjustments<!--]--></a></h3><p><!--[-->In our <code class=""><!--[-->useStripe<!--]--></code> composable, adjust <code class=""><!--[-->checkout<!--]--></code> to take a lookup_key parameter:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// composables/useStripe
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">export</span><span style="--shiki-default:#D73A49"> function</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">() {
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">  const</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#E36209">lookupKey</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#24292E">) </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">    const</span><span style="--shiki-default:#005CC5"> res</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> $fetch</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;/api/stripe/create-checkout-session&#39;</span><span style="--shiki-default:#24292E">, {
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">      method: </span><span style="--shiki-default:#032F62">&#39;POST&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      body: {
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">        lookup_key: lookupKey,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      },
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    })
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">    if</span><span style="--shiki-default:#24292E"> (res) {
</span></span><span class="line" line="12"><span style="--shiki-default:#D73A49">      await</span><span style="--shiki-default:#6F42C1"> navigateTo</span><span style="--shiki-default:#24292E">(res.url, {
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">        external: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">      })
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">    }
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="17"><span style="--shiki-default:#D73A49">  ...
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now let&#39;s adjust where we are calling <code class=""><!--[-->checkout<!--]--></code> in our <code class=""><!--[-->PricingSection<!--]--></code> component:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// components/PricingSection
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> handleBuyNow</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#E36209">lookupKey</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#24292E">) </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (data.value?.user?.isSubscribed) {
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> navigateToStripeDashboard</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#D73A49"> if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#24292E">(lookupKey)
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="8"><span style="--shiki-default:#6F42C1">    signIn</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->We adjust our <code class=""><!--[-->handleBuyNow<!--]--></code> function to accept a <code class=""><!--[-->lookupUp<!--]--></code> parameter that we then pass into our <code class=""><!--[-->checkout<!--]--></code> function.<!--]--></p><p><!--[-->Then in our template, we can adjust the button that calls the <code class=""><!--[-->handleBuyNow<!--]--></code> function to take in a parameter:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/PricingSection
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">...
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="5"><span style="--shiki-default:#6F42C1">    @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;() =&gt; handleBuyNow(tier.id)&quot;
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">    :aria-describedby</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="7"><span style="--shiki-default:#6F42C1">    :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;...&quot;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    {{ buttonText }}
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">...
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->We are iterating over each tier earlier in the template code, so we have access to the tier&#39;s id which we can then setup in Stripe&#39;s dashboard as our Product&#39;s lookup keys.<!--]--></p><p><!--[-->With this in place, you should be able to go through the Checkout flow and see that the plan changes based on which tier&#39;s Card you click on. It should match the price, name, and other values you set in Stripe&#39;s Product Catalog when creating the new Product(s).<!--]--></p><h3 id="plans"><a href="#plans"><!--[-->Plans<!--]--></a></h3><p><!--[-->There&#39;s nothing in our Database that saves this information so we are unable to render things based on which plan the user paid for.<!--]--></p><h4 id="account-table"><a href="#account-table"><!--[-->Account Table<!--]--></a></h4><p><!--[-->The solution I take for this problem is to extend my database schema to hold onto this information using a <code class=""><!--[-->plan<!--]--></code> column in my Account schema:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// prisma/schema.prisma
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">model Account {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  id                String  @id @</span><span style="--shiki-default:#6F42C1">default</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#6F42C1">cuid</span><span style="--shiki-default:#24292E">())
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  userId            String
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">  type</span><span style="--shiki-default:#6F42C1">              String
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">  provider          String
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  providerAccountId String
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  refresh_token     String?
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  access_token      String?
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">  expires_at        Int?
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">  token_type        String?
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  scope             String?
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  id_token          String?
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  session_state     String?
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">  createdAt DateTime @default(now())
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  updatedAt DateTime @updatedAt
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">  stripe_customer_id String? @unique
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">  is_subscribed      Boolean @default(false)
</span></span><span class="line" line="19"><span emptylineplaceholder="true">
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">  plan               String  @default(&quot;tier-free&quot;)
</span></span><span class="line" line="21"><span emptylineplaceholder="true">
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">  @@unique([provider, providerAccountId])
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">}</span><span style="--shiki-default:#032F62">```
</span></span><span class="line" line="25"><span emptylineplaceholder="true">
</span></span><span class="line" line="26"><span style="--shiki-default:#032F62">&gt; I set the default value to `</span><span style="--shiki-default:#24292E">tier</span><span style="--shiki-default:#D73A49">-</span><span style="--shiki-default:#6F42C1">free</span><span style="--shiki-default:#032F62">`.
</span></span><span class="line" line="27"><span emptylineplaceholder="true">
</span></span><span class="line" line="28"><span style="--shiki-default:#032F62">The reason I keep `</span><span style="--shiki-default:#6F42C1">is_subscribed</span><span style="--shiki-default:#032F62">` as well as `</span><span style="--shiki-default:#6F42C1">plan</span><span style="--shiki-default:#032F62">` as two separate database columns is because you may want to have logic that recommends users to re-subscribe to their old plan using deals or other methods.
</span></span><span class="line" line="29"><span emptylineplaceholder="true">
</span></span><span class="line" line="30"><span style="--shiki-default:#032F62">With this updated schema, run our Prisma commands again:
</span></span><span class="line" line="31"><span emptylineplaceholder="true">
</span></span><span class="line" line="32"><span style="--shiki-default:#032F62">```</span><span style="--shiki-default:#24292E">bash
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">npx prisma generate
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">npx prisma migrate dev
</span></span></code><!--]--></pre><!--]--><h4 id="auth-endpoint"><a href="#auth-endpoint"><!--[-->Auth Endpoint<!--]--></a></h4><p><!--[-->Now update our Auth endpoint&#39;s session <code class=""><!--[-->callback<!--]--></code> to expand on the returned user object, providing the user Account&#39;s <code class=""><!--[-->plan<!--]--></code>.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/auth/[...].ts
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1">callbacks</span><span style="--shiki-default:#24292E">: {
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D">    // Adding subscription status to default useAuth data object.
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">    async </span><span style="--shiki-default:#6F42C1">session</span><span style="--shiki-default:#24292E">({ session }) {
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">      if</span><span style="--shiki-default:#24292E"> (session.user?.email) {
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">        const</span><span style="--shiki-default:#005CC5"> accounts</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> await</span><span style="--shiki-default:#6F42C1"> getAccountsByEmail</span><span style="--shiki-default:#24292E">(session.user.email)
</span></span><span class="line" line="7"><span emptylineplaceholder="true">
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">        return</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">session,
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">          user: {
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">            ...</span><span style="--shiki-default:#24292E">session.user,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">            isSubscribed: accounts[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].is_subscribed,
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">            plan: accounts[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].plan,
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">          },
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">        }
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      }
</span></span><span class="line" line="17"><span style="--shiki-default:#D73A49">      return</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="18"><span style="--shiki-default:#D73A49">        ...</span><span style="--shiki-default:#24292E">session,
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">        user: {
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49">          ...</span><span style="--shiki-default:#24292E">session.user,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">          isSubscribed: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">          plan: </span><span style="--shiki-default:#032F62">&#39;tier-free&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">        },
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">      }
</span></span></code><!--]--></pre><!--]--><h4 id="webhook-updates"><a href="#webhook-updates"><!--[-->Webhook Updates<!--]--></a></h4><p><!--[-->We also have to update our Webhook so that Stripe passes us back the plan information when the subscription is successfully created.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/stripe/webhook.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">case</span><span style="--shiki-default:#032F62"> &#39;customer.subscription.created&#39;</span><span style="--shiki-default:#24292E">:
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  subscription </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  plan </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object.items.data[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].price.lookup_key
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">  await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">update</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    where: {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      stripe_customer_id: subscription.customer,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">    data: {
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">      is_subscribed: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">      plan,
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  })
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now that there are multiple plans, the user will have the ability to modify their plan in the Billing Portal. They can now go from Plan A â Plan B and visa-versa.<!--]--></p><p><!--[-->In my case, they may start out as a Freelancer, and decide they want additional pro features and sign up for an Enterprise user.<!--]--></p><p><!--[-->Stripe will send a webhook event called <code class=""><!--[-->customer.subscription.updated<!--]--></code> when this occurs. So, let&#39;s listen for it and update our user&#39;s Account accordingly:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// server/api/stripe/webhook.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">case</span><span style="--shiki-default:#032F62"> &#39;customer.subscription.updated&#39;</span><span style="--shiki-default:#24292E">:
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">  subscription </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  plan </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#24292E"> stripeEvent.data.object.items.data[</span><span style="--shiki-default:#005CC5">0</span><span style="--shiki-default:#24292E">].price.lookup_key
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">  await</span><span style="--shiki-default:#24292E"> prisma.account.</span><span style="--shiki-default:#6F42C1">update</span><span style="--shiki-default:#24292E">({
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">    where: {
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      stripe_customer_id: subscription.customer,
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">    data: {
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">      plan,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">  })
</span></span></code><!--]--></pre><!--]--><p><!--[-->Be sure to update your Webhook in Stripe&#39;s webhook settings so that Stripe sends this additional event.<!--]--></p><p><!--[--><img src="https://cln.sh/7ZBMSsq9+" alt="webhook settings|350"><!--]--></p><h4 id="typescript-session-interface"><a href="#typescript-session-interface"><!--[-->Typescript Session Interface<!--]--></a></h4><p><!--[-->Let&#39;s quickly extend the Session interface so that Typescript doesn&#39;t yell at us when we decide to access this <code class=""><!--[-->plan<!--]--></code> variable on the client.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// types/next-auth.d.ts
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> NextAuth, { DefaultSession } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;next-auth&#39;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">declare</span><span style="--shiki-default:#D73A49"> module</span><span style="--shiki-default:#032F62"> &#39;next-auth&#39;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">  /**
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D">   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider`
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D">   */
</span></span><span class="line" line="8"><span style="--shiki-default:#D73A49">  interface</span><span style="--shiki-default:#6F42C1"> Session</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="9"><span style="--shiki-default:#E36209">    user</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="10"><span style="--shiki-default:#6A737D">      /** The user&#39;s Stripe subscription status. */
</span></span><span class="line" line="11"><span style="--shiki-default:#E36209">      isSubscribed</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> boolean
</span></span><span class="line" line="12"><span style="--shiki-default:#E36209">      plan</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">    } </span><span style="--shiki-default:#D73A49">&amp;</span><span style="--shiki-default:#6F42C1"> DefaultSession</span><span style="--shiki-default:#24292E">[</span><span style="--shiki-default:#032F62">&#39;user&#39;</span><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><h2 id="_11-yearly-plans"><a href="#_11-yearly-plans"><!--[-->11 - Yearly Plans<!--]--></a></h2><blockquote><!--[--><p><!--[-->&quot;Buy 10 months, get two free!&quot;<!--]--></p><!--]--></blockquote><p><!--[-->Site&#39;s love to provide a discount with annual billing. So, let me show you how to incorporate it into your application.<!--]--></p><p><!--[-->I&#39;m sure many of you have seen this toggle:<!--]--></p><p><!--[--><img src="https://cln.sh/mxcRdNZB+" alt="yearly plan toggle!500"><!--]--></p><p><!--[-->Good news is, it&#39;s easy! The majority of the work is frontend-related, with a minor bit of Stripe work within their dashboard.<!--]--></p><h3 id="additional-product-pricing"><a href="#additional-product-pricing"><!--[-->Additional Product Pricing<!--]--></a></h3><p><!--[-->Visit each Product&#39;s details page on Stripe&#39;s Product Catalog page. Right now, we should only have one Price in the Pricing table. Click the <code class=""><!--[-->+<!--]--></code> button and add a new price. This time, make sure the <code class=""><!--[-->Billing period<!--]--></code> is yearly, the price reflects this new period, and add a <code class=""><!--[-->Lookup key<!--]--></code> that&#39;s unique to the yearly price.<!--]--></p><p><!--[--><img src="https://cln.sh/PGN833RN+" alt="Additional Pricing|500"><!--]--></p><h3 id="ui"><a href="#ui"><!--[-->UI<!--]--></a></h3><p><!--[-->We need to create a Toggle component. I&#39;ll call this component <code class=""><!--[-->ToggleWithText<!--]--></code>.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/ToggleWithText.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { Switch, SwitchGroup, SwitchLabel } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@headlessui/vue&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> enabled</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> defineModel</span><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#005CC5">boolean</span><span style="--shiki-default:#24292E">&gt;({ default: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E"> })
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="6"><span emptylineplaceholder="true">
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">SwitchGroup</span><span style="--shiki-default:#6F42C1"> as</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;div&quot;</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">Switch
</span></span><span class="line" line="10"><span style="--shiki-default:#6F42C1">      v-model</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;enabled&quot;
</span></span><span class="line" line="11"><span style="--shiki-default:#6F42C1">      :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="12"><span style="--shiki-default:#032F62">        enabled ? &#39;bg-indigo-600&#39; : &#39;bg-gray-200&#39;,
</span></span><span class="line" line="13"><span style="--shiki-default:#032F62">        &#39;relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2&#39;,
</span></span><span class="line" line="14"><span style="--shiki-default:#032F62">      ]&quot;
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">    &gt;
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">span
</span></span><span class="line" line="17"><span style="--shiki-default:#6F42C1">        aria-hidden</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;true&quot;
</span></span><span class="line" line="18"><span style="--shiki-default:#6F42C1">        :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="19"><span style="--shiki-default:#032F62">          enabled ? &#39;translate-x-5&#39; : &#39;translate-x-0&#39;,
</span></span><span class="line" line="20"><span style="--shiki-default:#032F62">          &#39;pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out&#39;,
</span></span><span class="line" line="21"><span style="--shiki-default:#032F62">        ]&quot;
</span></span><span class="line" line="22"><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">      /</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">Switch</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">SwitchLabel</span><span style="--shiki-default:#6F42C1"> as</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;span&quot;</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ml-3 text-sm&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;font-medium text-gray-900&quot;</span><span style="--shiki-default:#24292E">&gt;Annual Billing&lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">SwitchLabel</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">SwitchGroup</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->This gives us the ability to pass a <code class=""><!--[-->v-model<!--]--></code> and have a reusable toggle component.<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">ToggleWithText</span><span style="--shiki-default:#6F42C1"> v-model</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;yearlyEnabled&quot;</span><span style="--shiki-default:#24292E"> /&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now we&#39;re going to use this toggle in our <code class=""><!--[-->PricingSection<!--]--></code> component. Add a new ref:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> yearlyEnabled</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> ref</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">)
</span></span></code><!--]--></pre><!--]--><p><!--[-->As well as a new computed property:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> filteredTiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> computed</span><span style="--shiki-default:#24292E">(() </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#24292E"> tiers.</span><span style="--shiki-default:#6F42C1">filter</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">tier</span><span style="--shiki-default:#D73A49"> =&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">    yearlyEnabled.value </span><span style="--shiki-default:#D73A49">?</span><span style="--shiki-default:#24292E"> tier.type </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;yearly&#39;</span><span style="--shiki-default:#D73A49"> :</span><span style="--shiki-default:#24292E"> tier.type </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;monthly&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  )
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">})
</span></span></code><!--]--></pre><!--]--><p><!--[-->Our <code class=""><!--[-->PricingSection<!--]--></code> component&#39;s <code class=""><!--[-->script<!--]--></code> should now look like the following:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// components/PricingSection
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">&lt;</span><span style="--shiki-default:#24292E">script setup lang</span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#D73A49">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { CheckIcon } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@heroicons/vue/20/solid&#39;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> yearlyEnabled</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> ref</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">status</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signIn</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="7"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">checkout</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">navigateToStripeDashboard</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">tiers</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#6F42C1"> handleBuyNow</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#D73A49"> async</span><span style="--shiki-default:#24292E"> (</span><span style="--shiki-default:#E36209">lookupKey</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#24292E">) </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="10"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (data.value?.user?.isSubscribed) {
</span></span><span class="line" line="11"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> navigateToStripeDashboard</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#D73A49"> if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="13"><span style="--shiki-default:#D73A49">    await</span><span style="--shiki-default:#6F42C1"> checkout</span><span style="--shiki-default:#24292E">(lookupKey)
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="15"><span style="--shiki-default:#6F42C1">    signIn</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;github&#39;</span><span style="--shiki-default:#24292E">)
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="18"><span emptylineplaceholder="true">
</span></span><span class="line" line="19"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> buttonText</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> computed</span><span style="--shiki-default:#24292E">(() </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="20"><span style="--shiki-default:#D73A49">  if</span><span style="--shiki-default:#24292E"> (data.value?.user?.isSubscribed) {
</span></span><span class="line" line="21"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Manage Subscription&#39;
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#D73A49"> if</span><span style="--shiki-default:#24292E"> (status.value </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;authenticated&#39;</span><span style="--shiki-default:#24292E">) {
</span></span><span class="line" line="23"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Buy Now&#39;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">  } </span><span style="--shiki-default:#D73A49">else</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="25"><span style="--shiki-default:#D73A49">    return</span><span style="--shiki-default:#032F62"> &#39;Sign In to Buy&#39;
</span></span><span class="line" line="26"><span style="--shiki-default:#24292E">  }
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">})
</span></span><span class="line" line="28"><span emptylineplaceholder="true">
</span></span><span class="line" line="29"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> filteredTiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#6F42C1"> computed</span><span style="--shiki-default:#24292E">(() </span><span style="--shiki-default:#D73A49">=&gt;</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="30"><span style="--shiki-default:#D73A49">  return</span><span style="--shiki-default:#24292E"> tiers.</span><span style="--shiki-default:#6F42C1">filter</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#E36209">tier</span><span style="--shiki-default:#D73A49"> =&gt;
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">    yearlyEnabled.value </span><span style="--shiki-default:#D73A49">?</span><span style="--shiki-default:#24292E"> tier.type </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;yearly&#39;</span><span style="--shiki-default:#D73A49"> :</span><span style="--shiki-default:#24292E"> tier.type </span><span style="--shiki-default:#D73A49">===</span><span style="--shiki-default:#032F62"> &#39;monthly&#39;
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">  )
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">})
</span></span><span class="line" line="34"><span style="--shiki-default:#D73A49">&lt;/</span><span style="--shiki-default:#24292E">script</span><span style="--shiki-default:#D73A49">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now let&#39;s add the toggle with our new <code class=""><!--[-->yearlyEnabled<!--]--></code> ref to our template. We&#39;ll also iterate over <code class=""><!--[-->filteredTiers<!--]--></code> rather than just <code class=""><!--[-->tiers<!--]--></code>:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/PricingSection
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;bg-white py-10&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto max-w-7xl px-6 lg:px-8&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto max-w-4xl text-center&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">h2</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-base font-semibold leading-7 text-indigo-600&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">          Pricing
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">h2</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="11"><span style="--shiki-default:#6F42C1">          class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-2 text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl&quot;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">        &gt;
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">          Pricing plans for teams of</span><span style="--shiki-default:#005CC5">&amp;nbsp;</span><span style="--shiki-default:#24292E">all</span><span style="--shiki-default:#005CC5">&amp;nbsp;</span><span style="--shiki-default:#24292E">sizes
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="17"><span style="--shiki-default:#6F42C1">        class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mx-auto mt-6 max-w-2xl text-center text-lg leading-8 text-gray-600&quot;
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">      &gt;
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">        Distinctio et nulla eum soluta et neque labore quibusdam. Saepe et quasi
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">        iusto modi velit ut non voluptas in. Explicabo id ut laborum.
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="22"><span emptylineplaceholder="true">
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center justify-center mt-10 -mb-14&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">ToggleWithText</span><span style="--shiki-default:#6F42C1"> v-model</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;yearlyEnabled&quot;</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="25"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="26"><span emptylineplaceholder="true">
</span></span><span class="line" line="27"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">div
</span></span><span class="line" line="28"><span style="--shiki-default:#6F42C1">        class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;isolate mx-auto mt-16 grid max-w-md grid-cols-1 gap-y-8 sm:mt-20 lg:mx-0 lg:max-w-none lg:grid-cols-3&quot;
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      &gt;
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">        &lt;</span><span style="--shiki-default:#22863A">div
</span></span><span class="line" line="31"><span style="--shiki-default:#6F42C1">          v-for</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;(tier, tierIdx) in filteredTiers&quot;
</span></span><span class="line" line="32"><span style="--shiki-default:#6F42C1">          :key</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="33"><span style="--shiki-default:#6F42C1">          :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="34"><span style="--shiki-default:#032F62">            tier.mostPopular ? &#39;lg:z-10 lg:rounded-b-none&#39; : &#39;lg:mt-8&#39;,
</span></span><span class="line" line="35"><span style="--shiki-default:#032F62">            tierIdx === 0 ? &#39;lg:rounded-r-none&#39; : &#39;&#39;,
</span></span><span class="line" line="36"><span style="--shiki-default:#032F62">            tierIdx === tiers.length - 1 ? &#39;lg:rounded-l-none&#39; : &#39;&#39;,
</span></span><span class="line" line="37"><span style="--shiki-default:#032F62">            &#39;flex flex-col justify-between rounded-3xl bg-white p-8 ring-1 ring-gray-200 xl:p-10&#39;,
</span></span><span class="line" line="38"><span style="--shiki-default:#032F62">          ]&quot;
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">        &gt;
</span></span><span class="line" line="40"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="41"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex items-center justify-between gap-x-4&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="42"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">h3
</span></span><span class="line" line="43"><span style="--shiki-default:#6F42C1">                :id</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="44"><span style="--shiki-default:#6F42C1">                :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="45"><span style="--shiki-default:#032F62">                  tier.mostPopular ? &#39;text-indigo-600&#39; : &#39;text-gray-900&#39;,
</span></span><span class="line" line="46"><span style="--shiki-default:#032F62">                  &#39;text-lg font-semibold leading-8&#39;,
</span></span><span class="line" line="47"><span style="--shiki-default:#032F62">                ]&quot;
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="49"><span style="--shiki-default:#24292E">                {{ tier.name }}
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">h3</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">p
</span></span><span class="line" line="52"><span style="--shiki-default:#6F42C1">                v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.mostPopular&quot;
</span></span><span class="line" line="53"><span style="--shiki-default:#6F42C1">                class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;rounded-full bg-indigo-600/10 px-2.5 py-1 text-xs font-semibold leading-5 text-indigo-600&quot;
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="55"><span style="--shiki-default:#24292E">                Most popular
</span></span><span class="line" line="56"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="57"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="58"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-4 text-sm leading-6 text-gray-600&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="59"><span style="--shiki-default:#24292E">              {{ tier.description }}
</span></span><span class="line" line="60"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="61"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-6 flex items-baseline gap-x-1&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-4xl font-bold tracking-tight text-gray-900&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">                {{ tier.price }}
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="65"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#6F42C1"> class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;text-sm font-semibold leading-6 text-gray-600&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="66"><span style="--shiki-default:#24292E">                {{ yearlyEnabled ? &#39;/year&#39; : &#39;/month&#39; }}
</span></span><span class="line" line="67"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="68"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">p</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="69"><span style="--shiki-default:#24292E">            &lt;</span><span style="--shiki-default:#22863A">ul
</span></span><span class="line" line="70"><span style="--shiki-default:#6F42C1">              role</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;list&quot;
</span></span><span class="line" line="71"><span style="--shiki-default:#6F42C1">              class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;mt-8 space-y-3 text-sm leading-6 text-gray-600&quot;
</span></span><span class="line" line="72"><span style="--shiki-default:#24292E">            &gt;
</span></span><span class="line" line="73"><span style="--shiki-default:#24292E">              &lt;</span><span style="--shiki-default:#22863A">li
</span></span><span class="line" line="74"><span style="--shiki-default:#6F42C1">                v-for</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;feature in tier.features&quot;
</span></span><span class="line" line="75"><span style="--shiki-default:#6F42C1">                :key</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;feature&quot;
</span></span><span class="line" line="76"><span style="--shiki-default:#6F42C1">                class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;flex gap-x-3&quot;
</span></span><span class="line" line="77"><span style="--shiki-default:#24292E">              &gt;
</span></span><span class="line" line="78"><span style="--shiki-default:#24292E">                &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">CheckIcon
</span></span><span class="line" line="79"><span style="--shiki-default:#6F42C1">                  class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;h-6 w-5 flex-none text-indigo-600&quot;
</span></span><span class="line" line="80"><span style="--shiki-default:#6F42C1">                  aria-hidden</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;true&quot;
</span></span><span class="line" line="81"><span style="--shiki-default:#24292E">                /&gt;
</span></span><span class="line" line="82"><span style="--shiki-default:#24292E">                {{ feature }}
</span></span><span class="line" line="83"><span style="--shiki-default:#24292E">              &lt;/</span><span style="--shiki-default:#22863A">li</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="84"><span style="--shiki-default:#24292E">            &lt;/</span><span style="--shiki-default:#22863A">ul</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="85"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="86"><span style="--shiki-default:#24292E">          &lt;</span><span style="--shiki-default:#22863A">button
</span></span><span class="line" line="87"><span style="--shiki-default:#6F42C1">            @click</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;() =&gt; handleBuyNow(tier.id)&quot;
</span></span><span class="line" line="88"><span style="--shiki-default:#6F42C1">            :aria-describedby</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;tier.id&quot;
</span></span><span class="line" line="89"><span style="--shiki-default:#6F42C1">            :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;[
</span></span><span class="line" line="90"><span style="--shiki-default:#032F62">              tier.mostPopular
</span></span><span class="line" line="91"><span style="--shiki-default:#032F62">                ? &#39;bg-indigo-600 text-white shadow-sm hover:bg-indigo-500&#39;
</span></span><span class="line" line="92"><span style="--shiki-default:#032F62">                : &#39;text-indigo-600 ring-1 ring-inset ring-indigo-200 hover:ring-indigo-300&#39;,
</span></span><span class="line" line="93"><span style="--shiki-default:#032F62">              &#39;mt-8 block rounded-md px-3 py-2 text-center text-sm font-semibold leading-6 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600&#39;,
</span></span><span class="line" line="94"><span style="--shiki-default:#032F62">            ]&quot;
</span></span><span class="line" line="95"><span style="--shiki-default:#24292E">          &gt;
</span></span><span class="line" line="96"><span style="--shiki-default:#24292E">            {{ buttonText }}
</span></span><span class="line" line="97"><span style="--shiki-default:#24292E">          &lt;/</span><span style="--shiki-default:#22863A">button</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="98"><span style="--shiki-default:#24292E">        &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="99"><span style="--shiki-default:#24292E">      &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="100"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="101"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">div</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="102"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Now, we need to update our tiers to include the yearly amounts.<!--]--></p><p><!--[-->Here&#39;s an example of one of the yearly tiers:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">{
</span></span><span class="line" line="2"><span style="--shiki-default:#6F42C1">  name</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="3"><span style="--shiki-default:#6F42C1">  id</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer-yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="4"><span style="--shiki-default:#6F42C1">  href</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#6F42C1">  price</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;$240&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">  description</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="7"><span style="--shiki-default:#6F42C1">  features</span><span style="--shiki-default:#24292E">: [
</span></span><span class="line" line="8"><span style="--shiki-default:#032F62">    &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="9"><span style="--shiki-default:#032F62">    &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#032F62">    &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="11"><span style="--shiki-default:#032F62">    &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">  ],
</span></span><span class="line" line="13"><span style="--shiki-default:#6F42C1">  mostPopular</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="14"><span style="--shiki-default:#6F42C1">  type</span><span style="--shiki-default:#24292E">: </span><span style="--shiki-default:#032F62">&#39;yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">},
</span></span></code><!--]--></pre><!--]--><p><!--[-->The only difference between this tier and the monthly version is the <code class=""><!--[-->id<!--]--></code> and <code class=""><!--[-->type<!--]--></code> field. But, this is up to you. You can adjust this object however you like. The key is <code class=""><!--[-->type: &#39;yearly&#39;<!--]--></code> - this is how we will filter the tier.<!--]--></p><p><!--[-->Here&#39;s my entire <code class=""><!--[-->tiers<!--]--></code> value when updated with the yearly objects:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> tiers</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="3"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="6"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$24&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="9"><span style="--shiki-default:#032F62">        &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="10"><span style="--shiki-default:#032F62">        &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="11"><span style="--shiki-default:#032F62">        &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="12"><span style="--shiki-default:#032F62">        &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;monthly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="16"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="17"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="18"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="21"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$32&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="22"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;A plan that scales with your rapidly growing business.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="24"><span style="--shiki-default:#032F62">        &#39;25 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="25"><span style="--shiki-default:#032F62">        &#39;Up to 10,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="26"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="27"><span style="--shiki-default:#032F62">        &#39;24-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="28"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="30"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;monthly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="35"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="36"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="37"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$48&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="38"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;Dedicated support and infrastructure for your company.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="39"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="40"><span style="--shiki-default:#032F62">        &#39;Unlimited products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="41"><span style="--shiki-default:#032F62">        &#39;Unlimited subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="42"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="43"><span style="--shiki-default:#032F62">        &#39;1-hour, dedicated support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="44"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="45"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="46"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="47"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;monthly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="48"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="49"><span emptylineplaceholder="true">
</span></span><span class="line" line="50"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="51"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Freelancer&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="52"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-freelancer-yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="53"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="54"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$240&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="55"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;The essentials to provide your best work for clients.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="56"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="57"><span style="--shiki-default:#032F62">        &#39;5 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="58"><span style="--shiki-default:#032F62">        &#39;Up to 1,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="59"><span style="--shiki-default:#032F62">        &#39;Basic analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="60"><span style="--shiki-default:#032F62">        &#39;48-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="61"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="62"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="63"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="64"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="65"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="66"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Startup&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="67"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-startup-yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="68"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="69"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$320&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="70"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;A plan that scales with your rapidly growing business.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="71"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="72"><span style="--shiki-default:#032F62">        &#39;25 products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="73"><span style="--shiki-default:#032F62">        &#39;Up to 10,000 subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="74"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="75"><span style="--shiki-default:#032F62">        &#39;24-hour support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="76"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="77"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="78"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">true</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="79"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="80"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="81"><span style="--shiki-default:#24292E">    {
</span></span><span class="line" line="82"><span style="--shiki-default:#24292E">      name: </span><span style="--shiki-default:#032F62">&#39;Enterprise&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="83"><span style="--shiki-default:#24292E">      id: </span><span style="--shiki-default:#032F62">&#39;tier-enterprise-yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="84"><span style="--shiki-default:#24292E">      href: </span><span style="--shiki-default:#032F62">&#39;#&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="85"><span style="--shiki-default:#24292E">      price: </span><span style="--shiki-default:#032F62">&#39;$480&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="86"><span style="--shiki-default:#24292E">      description: </span><span style="--shiki-default:#032F62">&#39;Dedicated support and infrastructure for your company.&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="87"><span style="--shiki-default:#24292E">      features: [
</span></span><span class="line" line="88"><span style="--shiki-default:#032F62">        &#39;Unlimited products&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="89"><span style="--shiki-default:#032F62">        &#39;Unlimited subscribers&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="90"><span style="--shiki-default:#032F62">        &#39;Advanced analytics&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="91"><span style="--shiki-default:#032F62">        &#39;1-hour, dedicated support response time&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="92"><span style="--shiki-default:#032F62">        &#39;Marketing automations&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="93"><span style="--shiki-default:#24292E">      ],
</span></span><span class="line" line="94"><span style="--shiki-default:#24292E">      mostPopular: </span><span style="--shiki-default:#005CC5">false</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="95"><span style="--shiki-default:#24292E">      type: </span><span style="--shiki-default:#032F62">&#39;yearly&#39;</span><span style="--shiki-default:#24292E">,
</span></span><span class="line" line="96"><span style="--shiki-default:#24292E">    },
</span></span><span class="line" line="97"><span style="--shiki-default:#24292E">]
</span></span></code><!--]--></pre><!--]--><p><!--[-->With these changes in place, you should now see the <code class=""><!--[-->plan<!--]--></code> value reflected in your database.<!--]--></p><h2 id="_12-permissions"><a href="#_12-permissions"><!--[-->12 - Permissions<!--]--></a></h2><p><!--[-->I want to show you how we can easily adjust permissions on our site with our <code class=""><!--[-->plan<!--]--></code> value.<!--]--></p><p><!--[-->Our user&#39;s <code class=""><!--[-->plan<!--]--></code> value is being passed to the client in the <code class=""><!--[-->data<!--]--></code> variable extracted from <code class=""><!--[-->useAuth<!--]--></code>:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D">// data.user.plan
</span></span></code><!--]--></pre><!--]--><p><!--[-->Let&#39;s play with it in our <code class=""><!--[-->AuthMenu<!--]--></code> component:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">// components/AuthMenu.vue
</span></span><span class="line" line="2"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="3"><span style="--shiki-default:#D73A49">import</span><span style="--shiki-default:#24292E"> { Popover, PopoverButton, PopoverPanel } </span><span style="--shiki-default:#D73A49">from</span><span style="--shiki-default:#032F62"> &#39;@headlessui/vue&#39;
</span></span><span class="line" line="4"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">data</span><span style="--shiki-default:#24292E">, </span><span style="--shiki-default:#005CC5">signOut</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useAuth</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="5"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#24292E"> { </span><span style="--shiki-default:#005CC5">navigateToStripeDashboard</span><span style="--shiki-default:#24292E"> } </span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#6F42C1"> useStripe</span><span style="--shiki-default:#24292E">()
</span></span><span class="line" line="6"><span style="--shiki-default:#D73A49">const</span><span style="--shiki-default:#005CC5"> solutions</span><span style="--shiki-default:#D73A49"> =</span><span style="--shiki-default:#24292E"> [
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Manage Billing&#39;</span><span style="--shiki-default:#24292E">, fn: navigateToStripeDashboard },
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">  { name: </span><span style="--shiki-default:#032F62">&#39;Sign Out&#39;</span><span style="--shiki-default:#24292E">, fn: signOut },
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">]
</span></span><span class="line" line="10"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="11"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="12"><span style="--shiki-default:#24292E">    ...
</span></span><span class="line" line="13"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">AuthAvatar</span><span style="--shiki-default:#6F42C1"> :src</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;data?.user?.image&quot;</span><span style="--shiki-default:#6F42C1"> :plan</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;data?.user?.plan&quot;</span><span style="--shiki-default:#24292E"> /&gt;
</span></span><span class="line" line="14"><span style="--shiki-default:#24292E">    ...
</span></span><span class="line" line="15"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->Pass our <code class=""><!--[-->AuthAvatar<!--]--></code> component a new prop: <code class=""><!--[-->:plan=&quot;data?.user?.plan&quot;<!--]--></code><!--]--></p><p><!--[-->And update the <code class=""><!--[-->Prop<!--]--></code> interface in our <code class=""><!--[-->AuthAvatar<!--]--></code> component:<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#D73A49">interface</span><span style="--shiki-default:#6F42C1"> Props</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="2"><span style="--shiki-default:#E36209">  src</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> null</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> undefined
</span></span><span class="line" line="3"><span style="--shiki-default:#E36209">  plan</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> null</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> undefined
</span></span><span class="line" line="4"><span style="--shiki-default:#24292E">}
</span></span></code><!--]--></pre><!--]--><p><!--[-->Then add this dynamic class to your Avatar&#39;s img element.<!--]--></p><!--[--><pre class="language-ts shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">:class</span><span style="--shiki-default:#D73A49">=</span><span style="--shiki-default:#032F62">&quot;</span><span style="--shiki-default:#B31D28;--shiki-default-font-style:italic">{
</span></span><span class="line" line="2"><span style="--shiki-default:#032F62">  &#39;border-indigo-500&#39;</span><span style="--shiki-default:#24292E">: plan?.</span><span style="--shiki-default:#6F42C1">includes</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;tier-freelance&#39;</span><span style="--shiki-default:#24292E">),
</span></span><span class="line" line="3"><span style="--shiki-default:#032F62">  &#39;border-red-500&#39;</span><span style="--shiki-default:#24292E">: plan?.</span><span style="--shiki-default:#6F42C1">includes</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;tier-startup&#39;</span><span style="--shiki-default:#24292E">),
</span></span><span class="line" line="4"><span style="--shiki-default:#032F62">  &#39;border-green-500&#39;</span><span style="--shiki-default:#24292E">: plan?.</span><span style="--shiki-default:#6F42C1">includes</span><span style="--shiki-default:#24292E">(</span><span style="--shiki-default:#032F62">&#39;tier-enterprise&#39;</span><span style="--shiki-default:#24292E">),
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">}</span><span style="--shiki-default:#032F62">&quot;
</span></span></code><!--]--></pre><!--]--><p><!--[-->So now the Avatar image should have a colorful border depending on which tier you&#39;re in.<!--]--></p><p><!--[-->Final <code class=""><!--[-->AuthAvatar<!--]--></code> code:<!--]--></p><!--[--><pre class="language-html shiki shiki-themes github-light" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#6F42C1"> lang</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;ts&quot;</span><span style="--shiki-default:#6F42C1"> setup</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="2"><span style="--shiki-default:#D73A49">interface</span><span style="--shiki-default:#6F42C1"> Props</span><span style="--shiki-default:#24292E"> {
</span></span><span class="line" line="3"><span style="--shiki-default:#E36209">  src</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> null</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> undefined
</span></span><span class="line" line="4"><span style="--shiki-default:#E36209">  plan</span><span style="--shiki-default:#D73A49">:</span><span style="--shiki-default:#005CC5"> string</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> null</span><span style="--shiki-default:#D73A49"> |</span><span style="--shiki-default:#005CC5"> undefined
</span></span><span class="line" line="5"><span style="--shiki-default:#24292E">}
</span></span><span class="line" line="6"><span style="--shiki-default:#6F42C1">defineProps</span><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#6F42C1">Props</span><span style="--shiki-default:#24292E">&gt;()
</span></span><span class="line" line="7"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">script</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="8"><span style="--shiki-default:#24292E">&lt;</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="9"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">img
</span></span><span class="line" line="10"><span style="--shiki-default:#6F42C1">    v-if</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;src&quot;
</span></span><span class="line" line="11"><span style="--shiki-default:#6F42C1">    class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;inline-block h-10 w-10 rounded-full bg-gray-500 border-2&quot;
</span></span><span class="line" line="12"><span style="--shiki-default:#6F42C1">    :class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;{
</span></span><span class="line" line="13"><span style="--shiki-default:#032F62">      &#39;border-indigo-500&#39;: plan?.includes(&#39;tier-freelance&#39;),
</span></span><span class="line" line="14"><span style="--shiki-default:#032F62">      &#39;border-red-500&#39;: plan?.includes(&#39;tier-startup&#39;),
</span></span><span class="line" line="15"><span style="--shiki-default:#032F62">      &#39;border-green-500&#39;: plan?.includes(&#39;tier-enterprise&#39;),
</span></span><span class="line" line="16"><span style="--shiki-default:#032F62">    }&quot;
</span></span><span class="line" line="17"><span style="--shiki-default:#6F42C1">    :src</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;src&quot;
</span></span><span class="line" line="18"><span style="--shiki-default:#6F42C1">    alt</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;User avatar&quot;
</span></span><span class="line" line="19"><span style="--shiki-default:#24292E">  /&gt;
</span></span><span class="line" line="20"><span style="--shiki-default:#24292E">  &lt;</span><span style="--shiki-default:#22863A">span
</span></span><span class="line" line="21"><span style="--shiki-default:#6F42C1">    v-else
</span></span><span class="line" line="22"><span style="--shiki-default:#6F42C1">    class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;inline-block h-10 w-10 overflow-hidden rounded-full bg-gray-100&quot;
</span></span><span class="line" line="23"><span style="--shiki-default:#24292E">  &gt;
</span></span><span class="line" line="24"><span style="--shiki-default:#24292E">    &lt;</span><span style="--shiki-default:#22863A">svg
</span></span><span class="line" line="25"><span style="--shiki-default:#6F42C1">      class</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;h-full w-full text-gray-300&quot;
</span></span><span class="line" line="26"><span style="--shiki-default:#6F42C1">      fill</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;currentColor&quot;
</span></span><span class="line" line="27"><span style="--shiki-default:#6F42C1">      viewBox</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;0 0 24 24&quot;
</span></span><span class="line" line="28"><span style="--shiki-default:#24292E">    &gt;
</span></span><span class="line" line="29"><span style="--shiki-default:#24292E">      &lt;</span><span style="--shiki-default:#22863A">path
</span></span><span class="line" line="30"><span style="--shiki-default:#6F42C1">        d</span><span style="--shiki-default:#24292E">=</span><span style="--shiki-default:#032F62">&quot;M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z&quot;
</span></span><span class="line" line="31"><span style="--shiki-default:#24292E">      /&gt;
</span></span><span class="line" line="32"><span style="--shiki-default:#24292E">    &lt;/</span><span style="--shiki-default:#22863A">svg</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="33"><span style="--shiki-default:#24292E">  &lt;/</span><span style="--shiki-default:#22863A">span</span><span style="--shiki-default:#24292E">&gt;
</span></span><span class="line" line="34"><span style="--shiki-default:#24292E">&lt;/</span><span style="--shiki-default:#22863A">template</span><span style="--shiki-default:#24292E">&gt;
</span></span></code><!--]--></pre><!--]--><p><!--[-->This is a very simple example, but it showcases how easy it is to now dynamically show content based on the user&#39;s subscription tier.<!--]--></p><h2 id="_13-deploy"><a href="#_13-deploy"><!--[-->13 - Deploy<!--]--></a></h2><blockquote><!--[--><p><!--[-->Coming soon...<!--]--></p><!--]--></blockquote><h2 id="conclusion"><a href="#conclusion"><!--[-->Conclusion<!--]--></a></h2><blockquote><!--[--><p><!--[-->And that&#39;s it!<!--]--></p><!--]--></blockquote><p><!--[-->I hope this was able to help you along your journey to integrating payments into your Nuxt application. This article has been a long time coming.<!--]--></p><p><!--[-->Let me know if you have any questions, comments, or concerns. If you run into errors in the code, please let me know and I&#39;ll update the examples to help future readers.<!--]--></p><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div></article><div data-orientation="horizontal" role="separator" class="shrink-0 bg-border relative h-px w-full my-20"><!--[--><!--]--></div><div><h2 class="mb-6">You might also enjoy</h2><ul><!--[--><li class="flex items-baseline leading-tight mb-1"><div class="flex-shrink-0 text-gray-600 text-md pr-6 font-mono">2023 Â· 02</div><a href="/lets-setup-nuxt-3-with-cypress" class="opacity-90 hover:opacity-50 hover:underline text-lg truncate">Lets setup Nuxt 3 with Cypress</a></li><li class="flex items-baseline leading-tight mb-1"><div class="flex-shrink-0 text-gray-600 text-md pr-6 font-mono">2022 Â· 05</div><a href="/how-to-use-vuetify-with-nuxt-3" class="opacity-90 hover:opacity-50 hover:underline text-lg truncate">How to use Vuetify with Nuxt 3</a></li><li class="flex items-baseline leading-tight mb-1"><div class="flex-shrink-0 text-gray-600 text-md pr-6 font-mono">2022 Â· 02</div><a href="/using-url-query-params-in-nuxt-3" class="opacity-90 hover:opacity-50 hover:underline text-lg truncate">Using URL Query Params in Nuxt 3</a></li><li class="flex items-baseline leading-tight mb-1"><div class="flex-shrink-0 text-gray-600 text-md pr-6 font-mono">2022 Â· 02</div><a href="/silently-update-url-nuxt-3" class="opacity-90 hover:opacity-50 hover:underline text-lg truncate">Silently Update URL in Nuxt 3</a></li><li class="flex items-baseline leading-tight mb-1"><div class="flex-shrink-0 text-gray-600 text-md pr-6 font-mono">2023 Â· 08</div><a href="/hide-username-on-mac-terminal-prompt" class="opacity-90 hover:opacity-50 hover:underline text-lg truncate">Hide username on Mac terminal prompt</a></li><!--]--></ul></div></main></div></div></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/stripe-integration-in-nuxt-3/_payload.json?bee36402-9458-4c0a-a7be-77597351ee38">[{"state":1,"once":4,"_errors":5,"serverRendered":8,"path":9,"prerenderedAt":10},["Reactive",2],{"$snuxt-i18n-meta":3},{},["Set"],["ShallowReactive",6],{"post-/stripe-integration-in-nuxt-3":7,"allArticles":7},null,true,"/stripe-integration-in-nuxt-3",1730670331454]</script>
<script>window.__NUXT__={};window.__NUXT__.config={public:{mdc:{components:{prose:true,map:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"}},headings:{anchorLinks:{h1:true,h2:true,h3:true,h4:true,h5:true,h6:true}}},content:{locales:[],defaultLocale:"",integrity:1730670306201,experimental:{stripQueryParameters:false,advanceQuery:false,clientDB:false},respectPathCase:false,api:{baseURL:"/api/_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"ProseCodeInline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"github-light",highlighter:"shiki",shikiEngine:"oniguruma",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml"]},wsUrl:"",documentDriven:false,host:"",trailingSlash:false,search:"",contentHead:true,anchorLinks:true},i18n:{baseUrl:"",defaultLocale:"eng_Latn",defaultDirection:"ltr",strategy:"no_prefix",lazy:false,rootRedirect:"",routesNameSeparator:"___",defaultLocaleRouteNameSuffix:"default",skipSettingLocaleOnNavigate:false,differentDomains:false,trailingSlash:false,configLocales:[{code:"eng_Latn",title:"English"}],locales:{eng_Latn:{domain:""}},detectBrowserLanguage:{alwaysRedirect:false,cookieCrossOrigin:false,cookieDomain:"",cookieKey:"nuxt_i18n",cookieSecure:false,fallbackLocale:"",redirectOn:"root",useCookie:true},experimental:{localeDetector:"",switchLocalePathLinkSSR:false,autoImportTranslationFunctions:false},multiDomainLocales:false},studio:{apiURL:"https://api.nuxt.studio",iframeMessagingAllowedOrigins:""}},app:{baseURL:"/",buildId:"bee36402-9458-4c0a-a7be-77597351ee38",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>